<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2C3E50">
    
    <title>VFIED - What Should I Eat?</title>
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icon-180.png">
    <link rel="manifest" href="/manifest.json">
    
    <style>
/* VFIED One-Button Experience Styles - COMPLETE EMBEDDED VERSION */

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  overflow-x: hidden;
  min-height: 100vh;
}

/* App Container */
#app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Loading Screen */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.loading-content {
  text-align: center;
}

.loading-content .logo {
  font-size: 4rem;
  margin-bottom: 1rem;
  animation: pulse 2s infinite;
}

.loading-text {
  font-size: 1.2rem;
  margin-bottom: 2rem;
  opacity: 0.9;
}

.loading-dots {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
}

.loading-dots span {
  width: 8px;
  height: 8px;
  background: rgba(255, 255, 255, 0.7);
  border-radius: 50%;
  animation: bounce 1.4s infinite;
}

.loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; }

/* Main App */
.main-app {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding: 0;
}

.main-app.hidden {
  display: none;
}

/* Status Bar Spacer */
.status-bar-spacer {
  height: env(safe-area-inset-top, 20px);
  background: transparent;
}

/* Simple Header */
.simple-header {
  text-align: center;
  padding: 2rem 1rem 1rem;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
}

.app-title {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 0.5rem;
  background: linear-gradient(45deg, #fff, #f0f0f0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.question {
  font-size: 1.4rem;
  font-weight: 300;
  margin-bottom: 1rem;
  opacity: 0.9;
}

.context-info {
  font-size: 0.9rem;
  padding: 0.5rem 1rem;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  display: inline-block;
  backdrop-filter: blur(5px);
  opacity: 0.8;
  max-width: 90%;
  transition: all 0.3s ease;
}

/* Current Settings Display */
.current-settings {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  justify-content: center;
}

.setting-tag {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 15px;
  font-size: 0.8rem;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Quick Settings */
.quick-settings {
  position: relative;
  margin-bottom: 1rem;
}

.settings-btn {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
  cursor: pointer;
  backdrop-filter: blur(5px);
  transition: all 0.3s ease;
}

.settings-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-1px);
}

.settings-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  padding: 2rem;
  width: 90vw;
  max-width: 400px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.3);
  z-index: 9999;
}

.settings-panel.hidden {
  display: none;
}

/* Add overlay background when settings open */
.settings-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
  z-index: 9998;
  display: none;
}

.settings-overlay.show {
  display: block;
}

.settings-panel h3 {
  color: #2C3E50;
  margin-bottom: 1rem;
  font-size: 1.2rem;
  text-align: center;
}

.setting-group {
  margin-bottom: 1.5rem;
}

.setting-group label {
  display: block;
  color: #2C3E50;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.location-select, .dietary-select {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid #ddd;
  border-radius: 10px;
  font-size: 1rem;
  background: white;
  color: #2C3E50;
  transition: border-color 0.3s ease;
}

.location-select:focus, .dietary-select:focus {
  outline: none;
  border-color: #667eea;
}

.dietary-checkboxes {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.dietary-checkboxes label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: normal;
  font-size: 0.9rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 8px;
  transition: background-color 0.2s ease;
}

.dietary-checkboxes label:hover {
  background: rgba(102, 126, 234, 0.1);
}

.dietary-checkboxes input[type="checkbox"] {
  cursor: pointer;
}

.custom-location {
  margin-top: 0.5rem;
  padding: 0.75rem;
  border: 2px solid #ddd;
  border-radius: 10px;
  width: 100%;
  font-size: 1rem;
}

.custom-location.hidden {
  display: none;
}

.settings-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1.5rem;
}

.save-btn, .close-btn {
  flex: 1;
  padding: 0.75rem;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.save-btn {
  background: #667eea;
  color: white;
}

.save-btn:hover {
  background: #5a6fd8;
  transform: translateY(-1px);
}

.close-btn {
  background: #f8f9fa;
  color: #2C3E50;
  border: 1px solid #ddd;
}

.close-btn:hover {
  background: #e9ecef;
}

/* One Button Main */
.one-button-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem 1rem;
  min-height: 50vh;
}

/* The Giant Decision Button - FIXED TO ALWAYS BE CLICKABLE */
.decision-area {
  text-align: center;
  margin-bottom: 2rem;
}

.giant-decide-button {
  background: linear-gradient(145deg, #ff6b6b, #ee5a52);
  border: none;
  border-radius: 30px;
  padding: 2rem 3rem;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.2),
    0 8px 16px rgba(255, 107, 107, 0.3),
    inset 0 2px 0 rgba(255, 255, 255, 0.2);
  cursor: pointer !important;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  transform: translateY(0);
  min-width: 280px;
  position: relative;
  overflow: hidden;
  /* CRITICAL: Always allow clicks */
  pointer-events: auto !important;
  z-index: 10;
}

.giant-decide-button:hover {
  transform: translateY(-5px);
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.25),
    0 12px 24px rgba(255, 107, 107, 0.4),
    inset 0 2px 0 rgba(255, 255, 255, 0.2);
}

.giant-decide-button:active {
  transform: translateY(-2px);
}

/* FIXED: Button children don't block clicks */
.button-icon {
  font-size: 3rem;
  margin-bottom: 0.5rem;
  display: block;
  animation: gentle-bounce 2s infinite;
  pointer-events: none !important;
}

.button-text {
  font-size: 1.5rem;
  font-weight: 800;
  color: white;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  margin-bottom: 0.25rem;
  display: block;
  pointer-events: none !important;
}

.button-subtitle {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 400;
  pointer-events: none !important;
}

/* FIXED: Thinking state - only visual, don't disable clicks */
.giant-decide-button.thinking {
  opacity: 0.8;
  animation: gentle-pulse 1.5s infinite;
  pointer-events: auto !important;
  cursor: pointer !important;
}

/* Suggestion Result */
.suggestion-result {
  width: 100%;
  max-width: 400px;
  margin-top: 1rem;
  animation: fadeInUp 0.5s ease;
}

.suggestion-result.hidden {
  display: none;
}

.suggestion-card {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  margin-bottom: 1.5rem;
}

.food-emoji {
  font-size: 4rem;
  margin-bottom: 1rem;
  display: block;
}

.food-name {
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: white;
}

.food-description {
  font-size: 1rem;
  opacity: 0.9;
  margin-bottom: 1rem;
  line-height: 1.4;
}

.restaurant-info {
  font-size: 0.9rem;
  background: rgba(255, 255, 255, 0.1);
  padding: 0.5rem 1rem;
  border-radius: 15px;
  display: inline-block;
  opacity: 0.8;
}

/* Decision Actions */
.decision-actions {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
}

.action-btn {
  flex: 1;
  padding: 1rem;
  border: none;
  border-radius: 15px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer !important;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  pointer-events: auto !important;
}

.action-btn.accept {
  background: linear-gradient(145deg, #27AE60, #229954);
  color: white;
  box-shadow: 0 8px 16px rgba(39, 174, 96, 0.3);
}

.action-btn.accept:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 24px rgba(39, 174, 96, 0.4);
}

.action-btn.try-again {
  background: rgba(255, 255, 255, 0.15);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(5px);
}

.action-btn.try-again:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
}

/* AI Insights */
.ai-insights {
  margin-top: 1rem;
}

.insights-toggle {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: white;
  padding: 0.75rem 1rem;
  border-radius: 12px;
  font-size: 0.9rem;
  cursor: pointer !important;
  width: 100%;
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
  pointer-events: auto !important;
}

.insights-toggle:hover {
  background: rgba(255, 255, 255, 0.2);
}

.insights-content {
  margin-top: 1rem;
  animation: fadeIn 0.3s ease;
}

.insights-content.hidden {
  display: none;
}

.cultural-note,
.personal-note,
.weather-note {
  background: rgba(255, 255, 255, 0.1);
  padding: 1rem;
  border-radius: 12px;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  line-height: 1.4;
  backdrop-filter: blur(5px);
}

.cultural-note strong,
.personal-note strong,
.weather-note strong {
  display: block;
  margin-bottom: 0.25rem;
}

/* Simple Footer */
.simple-footer {
  text-align: center;
  padding: 1rem;
  background: rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
}

.stats-line {
  font-size: 0.9rem;
  opacity: 0.8;
  margin-bottom: 0.5rem;
}

.ai-status {
  font-size: 0.8rem;
  opacity: 0.6;
}

/* Bottom Safe Area */
.bottom-safe-area {
  height: env(safe-area-inset-bottom, 20px);
  background: rgba(0, 0, 0, 0.1);
}

/* Animations */
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-10px); }
  60% { transform: translateY(-5px); }
}

@keyframes gentle-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInUp {
  from { 
    opacity: 0; 
    transform: translateY(20px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

@keyframes gentle-pulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 0.6; }
}

/* Responsive Design */
@media (max-width: 480px) {
  .simple-header {
    padding: 1.5rem 1rem 1rem;
  }
  
  .app-title {
    font-size: 2rem;
  }
  
  .question {
    font-size: 1.2rem;
  }
  
  .giant-decide-button {
    padding: 1.5rem 2rem;
    min-width: 240px;
  }
  
  .button-text {
    font-size: 1.3rem;
  }
  
  .button-icon {
    font-size: 2.5rem;
  }
  
  .suggestion-card {
    padding: 1.5rem;
  }
  
  .food-name {
    font-size: 1.5rem;
  }
  
  .decision-actions {
    flex-direction: column;
  }
  
  .settings-panel {
    width: 95vw;
    padding: 1.5rem;
  }
  
  .dietary-checkboxes {
    grid-template-columns: 1fr;
  }

  .settings-actions {
    flex-direction: column;
  }
}

@media (max-height: 600px) {
  .one-button-main {
    padding: 1rem;
    min-height: auto;
  }
  
  .simple-header {
    padding: 1rem;
  }
}

/* Focus States for Accessibility */
.giant-decide-button:focus,
.action-btn:focus,
.insights-toggle:focus {
  outline: 2px solid rgba(255, 255, 255, 0.5);
  outline-offset: 2px;
}

/* CRITICAL: Force all buttons to be clickable */
button {
  pointer-events: auto !important;
  cursor: pointer !important;
}

/* Force main button clickability */
#decide-button {
  pointer-events: auto !important;
  cursor: pointer !important;
}

/* Ensure button children never block clicks */
#decide-button * {
  pointer-events: none !important;
}

/* Override any disabled state */
.giant-decide-button:disabled {
  pointer-events: auto !important;
  cursor: pointer !important;
  opacity: 0.8 !important;
}

/* Force clickability for all interactive elements */
.giant-decide-button,
.action-btn,
.insights-toggle,
.settings-btn,
.save-btn,
.close-btn {
  pointer-events: auto !important;
  cursor: pointer !important;
}/* Mood Section */
.mood-section {
    margin: 1.5rem 0;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.mood-section h3 {
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
    text-align: center;
    opacity: 0.9;
}

/* Quick Mood Buttons */
.mood-quick-options {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    justify-content: center;
}

.mood-quick-btn {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.mood-quick-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-1px);
}

/* Mood Input */
.mood-input-container {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.mood-input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 0.9rem;
    backdrop-filter: blur(5px);
}

.mood-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

.mood-detect-btn {
    background: linear-gradient(145deg, #667eea, #764ba2);
    border: none;
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.mood-detect-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
}

/* Detected Moods */
.detected-moods {
    animation: fadeIn 0.3s ease;
}

.detected-moods.hidden {
    display: none;
}

.mood-result {
    background: rgba(255, 255, 255, 0.15);
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    backdrop-filter: blur(5px);
}

.mood-tags {
    display: flex;
    gap: 0.5rem;
    margin: 0.5rem 0;
    flex-wrap: wrap;
    justify-content: center;
}

.mood-tag {
    background: rgba(102, 126, 234, 0.3);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.8rem;
    border: 1px solid rgba(102, 126, 234, 0.5);
}

.use-mood-btn {
    background: linear-gradient(145deg, #27AE60, #229954);
    border: none;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    margin-top: 0.5rem;
    transition: all 0.3s ease;
}

.use-mood-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(39, 174, 96, 0.3);
}

/* Mood Context in Suggestion */
.mood-context {
    background: rgba(102, 126, 234, 0.2);
    padding: 0.75rem;
    border-radius: 10px;
    margin-bottom: 1rem;
    text-align: center;
    border: 1px solid rgba(102, 126, 234, 0.3);
    backdrop-filter: blur(5px);
}

.mood-context.hidden {
    display: none;
}

.mood-match {
    font-size: 0.9rem;
    color: white;
}

/* Error states */
.mood-error {
    background: rgba(220, 53, 69, 0.2);
    color: white;
    padding: 0.75rem;
    border-radius: 10px;
    text-align: center;
    border: 1px solid rgba(220, 53, 69, 0.3);
}

.mood-loading {
    text-align: center;
    padding: 0.75rem;
    color: rgba(255, 255, 255, 0.8);
    font-style: italic;
}

/* Responsive Design */
@media (max-width: 480px) {
    .mood-quick-options {
        flex-direction: column;
        align-items: center;
    }
    
    .mood-quick-btn {
        width: 100%;
        max-width: 200px;
    }
    
    .mood-input-container {
        flex-direction: column;
    }
    
    .mood-detect-btn {
        width: 100%;
    }
}
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-content">
                <div class="logo">🍽️</div>
                <div class="loading-text">Waking up your food friend...</div>
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Main One-Button App -->
        <div id="main-app" class="main-app hidden">
            <!-- Status Bar Spacer -->
            <div class="status-bar-spacer"></div>
            
            <!-- Simple Header -->
            <header class="simple-header">
              <h1 class="app-title">VFIED</h1>
              <p class="question">What should I eat?</p>
              <div class="context-info" id="context-info">
                  🤖 Analyzing your situation...
              </div>
          
              <!-- Current Settings Display -->
              <div class="current-settings" id="current-settings">
                  <span class="setting-tag" id="location-tag">📍 Auto-detect</span>
                  <span class="setting-tag hidden" id="dietary-tag">🌱 No restrictions</span>
              </div>
          
              <!-- Quick Settings -->
              <div class="quick-settings">
                  <button id="settings-btn" class="settings-btn">⚙️ Preferences</button>
              </div>
          
              <!-- 🆕 ADD THIS MOOD SECTION HERE -->
              <div class="mood-section" id="mood-section">
                  <h3>🧠 How are you feeling?</h3>
                  
                  <!-- Quick Mood Options -->
                  <div class="mood-quick-options">
                      <button class="mood-quick-btn" onclick="quickMood('tired')">😴 Tired</button>
                      <button class="mood-quick-btn" onclick="quickMood('stressed')">😰 Stressed</button>
                      <button class="mood-quick-btn" onclick="quickMood('celebrating')">🎉 Celebrating</button>
                      <button class="mood-quick-btn" onclick="quickMood('post-workout')">💪 Post-workout</button>
                      <button class="mood-quick-btn" onclick="quickMood('hungry')">🤤 Hungry</button>
                  </div>
          
                  <!-- Custom Mood Input -->
                  <div class="mood-input-container">
                      <input 
                          type="text" 
                          id="mood-input" 
                          placeholder="Or describe your mood... (e.g., tired but celebrating, stressed and need comfort)"
                          class="mood-input"
                      >
                      <button id="detect-mood-btn" class="mood-detect-btn">✨ Detect</button>
                  </div>
          
                  <!-- Detected Moods Display -->
                  <div id="detected-moods" class="detected-moods hidden"></div>
              </div>
          </header>

            <!-- Settings Overlay (moved outside header) -->
            <div id="settings-overlay" class="settings-overlay"></div>
            <div id="settings-panel" class="settings-panel hidden">
                <h3>🍽️ Food Preferences</h3>
                
                <!-- Location Override -->
                <div class="setting-group">
                    <label>📍 Location:</label>
                    <select id="location-select" class="location-select">
                        <option value="">Auto-detect my location</option>
                        <option value="london,uk">🏰 London, UK</option>
                        <option value="nairobi,ke">🦁 Nairobi, Kenya</option>
                        <option value="tokyo,jp">🗼 Tokyo, Japan</option>
                        <option value="newyork,us">🗽 New York, USA</option>
                        <option value="paris,fr">🗼 Paris, France</option>
                        <option value="mumbai,in">🏙️ Mumbai, India</option>
                        <option value="lagos,ng">🌆 Lagos, Nigeria</option>
                        <option value="sydney,au">🏄 Sydney, Australia</option>
                        <option value="custom">✏️ Custom location...</option>
                    </select>
                    <input id="custom-location" type="text" placeholder="Enter: City, Country" class="custom-location hidden">
                </div>

                <!-- Dietary Restrictions -->
                <div class="setting-group">
                    <label>🌱 Dietary Restrictions:</label>
                    <div class="dietary-checkboxes">
                        <label><input type="checkbox" value="vegetarian"> 🌱 Vegetarian</label>
                        <label><input type="checkbox" value="vegan"> 🥬 Vegan</label>
                        <label><input type="checkbox" value="gluten-free"> 🌾 Gluten-Free</label>
                        <label><input type="checkbox" value="dairy-free"> 🥛 Dairy-Free</label>
                        <label><input type="checkbox" value="keto"> 🥩 Keto</label>
                        <label><input type="checkbox" value="halal"> ☪️ Halal</label>
                        <label><input type="checkbox" value="kosher"> ✡️ Kosher</label>
                        <label><input type="checkbox" value="paleo"> 🦴 Paleo</label>
                    </div>
                </div>

                <div class="settings-actions">
                    <button id="save-settings" class="save-btn">💾 Save</button>
                    <button id="close-settings" class="close-btn">❌ Close</button>
                </div>
            </div>

            <!-- The One Button -->
            <main class="one-button-main">
                <div class="decision-area">
                    <button id="decide-button" class="giant-decide-button">
                        <div class="button-icon" id="button-icon">🎯</div>
                        <div class="button-text" id="button-text">DECIDE FOR ME</div>
                        <div class="button-subtitle">I'll figure it out for you</div>
                    </button>
                </div>

                <!-- Quick Suggestion Display -->
                <div id="suggestion-result" class="suggestion-result hidden">
                    <div class="suggestion-card">
                      <div id="mood-context" class="mood-context hidden">
                        <div class="mood-match" id="mood-match-text">
                            🧠 <strong>Mood Match:</strong> Perfect for when you're feeling...
                        </div>
                    </div>
                        <div class="food-emoji" id="result-emoji">🍕</div>
                        <div class="food-info">
                            <h2 class="food-name" id="result-name">Pizza Night!</h2>
                            <p class="food-description" id="result-description">
                                Perfect for this tired Tuesday evening
                            </p>
                            <div class="restaurant-info" id="restaurant-info">
                                📍 Tony's Pizza (0.8km, open until 11pm)
                            </div>
                        </div>
                    </div>

                    <div class="decision-actions">
                        <button id="accept-btn" class="action-btn accept">
                            ✅ YES, GET IT!
                        </button>
                        <button id="try-again-btn" class="action-btn try-again">
                            🔄 TRY AGAIN
                        </button>
                    </div>

                    <!-- AI Insights (Collapsible) -->
                    <div class="ai-insights" id="ai-insights">
                        <button class="insights-toggle" id="insights-toggle">
                            🤖 Why this choice? ↓
                        </button>
                        <div class="insights-content hidden" id="insights-content">
                            <div class="cultural-note" id="cultural-note"></div>
                            <div class="personal-note" id="personal-note"></div>
                            <div class="weather-note" id="weather-note"></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Simple Footer Stats -->
            <footer class="simple-footer">
                <div class="stats-line">
                    <span id="decisions-count">12</span> decisions made • 
                    <span id="time-saved">42</span> minutes saved
                </div>
                <div class="ai-status" id="ai-status">
                    🤖 AI ready with cultural intelligence
                </div>
            </footer>

            <!-- Bottom Safe Area -->
            <div class="bottom-safe-area"></div>
        </div>
    </div>

    <script>
    // RESTORED REAL AI INTEGRATION - YOUR BUSINESS APP VERSION
    
    console.log('🚀 VFIED Real AI App Loading...');

    // ==================== SETTINGS SYSTEM ====================
    
    let userSettings = {
        location: null,
        dietary: [],
        customLocation: null
    };

    function loadSettings() {
        try {
            const saved = localStorage.getItem('vfied_user_settings');
            if (saved) {
                userSettings = { ...userSettings, ...JSON.parse(saved) };
                console.log('📂 Loaded settings:', userSettings);
            }
        } catch (error) {
            console.error('Settings load error:', error);
        }
    }

    function saveSettings() {
        try {
            localStorage.setItem('vfied_user_settings', JSON.stringify(userSettings));
            console.log('💾 Settings saved:', userSettings);
            notifyMainApp();
        } catch (error) {
            console.error('Settings save error:', error);
        }
    }

    function notifyMainApp() {
        const event = new CustomEvent('vfied-settings-updated', {
            detail: userSettings
        });
        window.dispatchEvent(event);
        
        if (window.vfiedAppInstance) {
            console.log('📢 Notifying main app directly');
            window.vfiedAppInstance.updatePreferences(userSettings);
        }
    }

    function updateSettingsDisplay() {
        const locationTag = document.getElementById('location-tag');
        const dietaryTag = document.getElementById('dietary-tag');

        if (userSettings.location) {
            const locationMap = {
                'london,uk': '🏰 London',
                'nairobi,ke': '🦁 Nairobi', 
                'tokyo,jp': '🗼 Tokyo',
                'newyork,us': '🗽 New York',
                'paris,fr': '🗼 Paris',
                'mumbai,in': '🏙️ Mumbai',
                'lagos,ng': '🌆 Lagos',
                'sydney,au': '🏄 Sydney'
            };
            
            locationTag.textContent = locationMap[userSettings.location] || 
                (userSettings.customLocation ? `📍 ${userSettings.customLocation}` : '📍 Custom');
        } else {
            locationTag.textContent = '📍 Auto-detect';
        }

        if (userSettings.dietary.length > 0) {
            const dietaryEmojis = {
                'vegetarian': '🌱', 'vegan': '🥬', 'gluten-free': '🌾',
                'dairy-free': '🥛', 'keto': '🥩', 'halal': '☪️',
                'kosher': '✡️', 'paleo': '🦴'
            };
            
            const icons = userSettings.dietary.map(d => dietaryEmojis[d] || '🍽️').join('');
            dietaryTag.textContent = `${icons} ${userSettings.dietary.length} restriction${userSettings.dietary.length > 1 ? 's' : ''}`;
            dietaryTag.classList.remove('hidden');
        } else {
            dietaryTag.classList.add('hidden');
        }
    }

    function getCurrentSettings() {
        const settings = { dietary: userSettings.dietary };

        if (userSettings.location && userSettings.location !== 'custom') {
            const locationMap = {
                'london,uk': { city: 'London', country: 'United Kingdom', countryCode: 'GB' },
                'nairobi,ke': { city: 'Nairobi', country: 'Kenya', countryCode: 'KE' },
                'tokyo,jp': { city: 'Tokyo', country: 'Japan', countryCode: 'JP' },
                'newyork,us': { city: 'New York', country: 'United States', countryCode: 'US' },
                'paris,fr': { city: 'Paris', country: 'France', countryCode: 'FR' },
                'mumbai,in': { city: 'Mumbai', country: 'India', countryCode: 'IN' },
                'lagos,ng': { city: 'Lagos', country: 'Nigeria', countryCode: 'NG' },
                'sydney,au': { city: 'Sydney', country: 'Australia', countryCode: 'AU' }
            };
            settings.location = locationMap[userSettings.location];
        } else if (userSettings.customLocation) {
            const parts = userSettings.customLocation.split(',').map(s => s.trim());
            if (parts.length >= 2) {
                settings.location = { city: parts[0], country: parts[1] };
            }
        }

        return settings;
    }

    function setupSettingsPanel() {
        const settingsBtn = document.getElementById('settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const settingsOverlay = document.getElementById('settings-overlay');
        const saveBtn = document.getElementById('save-settings');
        const closeBtn = document.getElementById('close-settings');
        const locationSelect = document.getElementById('location-select');
        const customLocationInput = document.getElementById('custom-location');

        if (!settingsBtn || !settingsPanel) return;

        function showSettings() {
            settingsPanel.classList.remove('hidden');
            settingsOverlay.classList.add('show');
            loadCurrentSettingsIntoPanel();
        }

        function hideSettings() {
            settingsPanel.classList.add('hidden');
            settingsOverlay.classList.remove('show');
        }

        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            showSettings();
        });

        settingsOverlay.addEventListener('click', hideSettings);

        if (locationSelect) {
            locationSelect.addEventListener('change', () => {
                if (locationSelect.value === 'custom') {
                    customLocationInput?.classList.remove('hidden');
                    customLocationInput?.focus();
                } else {
                    customLocationInput?.classList.add('hidden');
                }
            });
        }

        if (saveBtn) {
            saveBtn.addEventListener('click', () => {
                saveSettingsFromPanel();
                hideSettings();
                updateSettingsDisplay();
                
                const contextInfo = document.getElementById('context-info');
                if (contextInfo) {
                    contextInfo.textContent = '✅ Settings saved! Ready for personalized suggestions.';
                }
            });
        }

        if (closeBtn) {
            closeBtn.addEventListener('click', hideSettings);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !settingsPanel.classList.contains('hidden')) {
                hideSettings();
            }
        });
    }

    function loadCurrentSettingsIntoPanel() {
        const locationSelect = document.getElementById('location-select');
        const customLocationInput = document.getElementById('custom-location');
        const dietaryCheckboxes = document.querySelectorAll('.dietary-checkboxes input[type="checkbox"]');

        if (locationSelect) {
            locationSelect.value = userSettings.location || '';
            if (userSettings.location === 'custom' && userSettings.customLocation) {
                customLocationInput?.classList.remove('hidden');
                if (customLocationInput) customLocationInput.value = userSettings.customLocation;
            } else {
                customLocationInput?.classList.add('hidden');
            }
        }

        dietaryCheckboxes.forEach(checkbox => {
            checkbox.checked = userSettings.dietary.includes(checkbox.value);
        });
    }

    function saveSettingsFromPanel() {
        const locationSelect = document.getElementById('location-select');
        const customLocationInput = document.getElementById('custom-location');
        const dietaryCheckboxes = document.querySelectorAll('.dietary-checkboxes input[type="checkbox"]');

        if (locationSelect) {
            userSettings.location = locationSelect.value || null;
            if (locationSelect.value === 'custom') {
                userSettings.customLocation = customLocationInput?.value?.trim() || null;
            } else {
                userSettings.customLocation = null;
            }
        }

        userSettings.dietary = Array.from(dietaryCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        saveSettings();
        console.log('✅ Settings updated and main app notified:', userSettings);
    }

    // ==================== REAL AI SERVICE INTEGRATION ====================
    
    // REAL AI Functions - calls your actual MCP server and OpenAI
    async function getAIQuickDecision(context = {}) {
        console.log('🎲 Getting REAL AI quick decision with settings...');
        
        try {
            const userPrefs = getCurrentSettings();
            console.log('📍 Using location:', userPrefs.location);
            console.log('🌱 Using dietary:', userPrefs.dietary);
            
            // FIRST: Try your MCP server
            const response = await fetch('https://vfied-mcp-server.onrender.com/mcp/get_quick_food_decision', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    location: userPrefs.location,
                    dietary: userPrefs.dietary,
                    userId: context.userId || 'anonymous',
                    context: {
                        includeRestaurants: context.includeRestaurants,
                        quick: true,
                        budget: context.budget || 'medium',
                        timeConstraint: 'quick'
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`MCP server error: ${response.status}`);
            }

            const data = await response.json();
            console.log('✅ MCP response received:', data);
            
            return {
                ...data,
                source: 'mcp',
                interactionId: data.interactionId || Date.now().toString()
            };

        } catch (error) {
            console.error('❌ MCP call failed, using OpenAI fallback:', error);
            
            // FALLBACK: Direct OpenAI call
            return await getOpenAIFallback(context);
        }
    }

    async function getOpenAIFallback(context = {}) {
        const userPrefs = getCurrentSettings();
        const locationText = userPrefs.location ? userPrefs.location.city : 'your area';
        
        // This would be your actual OpenAI API call
        // For now, return a smart fallback that uses your settings
        const fallbackFoods = {
            'KE': [
                { emoji: '🍛', name: 'Ugali with Sukuma Wiki', desc: `Traditional Kenyan staple perfect for ${locationText}` },
                { emoji: '🥩', name: 'Nyama Choma', desc: `Grilled meat - a Kenyan favorite in ${locationText}` },
                { emoji: '🍚', name: 'Pilau', desc: `Spiced rice dish popular in ${locationText}` },
            ],
            'GB': [
                { emoji: '🍟', name: 'Fish and Chips', desc: `Classic British comfort food in ${locationText}` },
                { emoji: '🥧', name: 'Shepherd\'s Pie', desc: `Hearty traditional dish perfect for ${locationText}` },
            ],
            'US': [
                { emoji: '🍔', name: 'Classic Burger', desc: `American favorite available in ${locationText}` },
                { emoji: '🍕', name: 'Pizza', desc: `Perfect for a casual meal in ${locationText}` },
            ]
        };

        const countryCode = userPrefs.location?.countryCode || 'US';
        const availableFoods = fallbackFoods[countryCode] || fallbackFoods['US'];
        
        // Filter by dietary restrictions
        let suggestions = [...availableFoods];
        if (userPrefs.dietary && userPrefs.dietary.length > 0) {
            if (userPrefs.dietary.includes('vegetarian')) {
                suggestions = suggestions.filter(f => !['🥩', '🍔'].includes(f.emoji));
            }
            if (userPrefs.dietary.includes('vegan')) {
                suggestions = suggestions.filter(f => !['🥩', '🍔', '🧀'].includes(f.emoji));
            }
        }

        const choice = suggestions[Math.floor(Math.random() * suggestions.length)];
        
        return {
            food: {
                emoji: choice.emoji,
                name: choice.name
            },
            description: choice.desc,
            culturalNote: `This fits perfectly with ${locationText} food culture`,
            personalNote: userPrefs.dietary.length > 0 
                ? `Matches your ${userPrefs.dietary.join(', ')} preferences`
                : 'Based on your location preferences',
            reason: `Perfect choice for ${locationText} right now`,
            availabilityNote: `Available at local restaurants in ${locationText}`,
            source: 'ai-fallback',
            location: locationText
        };
    }

    // ==================== MAIN APP WITH REAL AI ====================
    
    class VFIEDRealApp {
        constructor() {
            this.currentSuggestion = null;
            this.isThinking = false;
            this.userPreferences = {};
            this.init();
        }

        init() {
            console.log('🤖 VFIED REAL AI App initializing...');
            this.loadUserPreferences();
            this.setupEventListeners();
            this.hideLoadingScreen();
        }

        loadUserPreferences() {
            this.userPreferences = getCurrentSettings();
            console.log('⚙️ Loaded user preferences:', this.userPreferences);
        }

        updatePreferences(newPreferences) {
            this.userPreferences = { ...this.userPreferences, ...newPreferences };
            console.log('⚙️ Updated app preferences:', this.userPreferences);
            this.updateContextInfo();
        }

        setupEventListeners() {
            // FIXED: Ensure button is always clickable
            const decideButton = document.getElementById('decide-button');
            if (decideButton) {
                // FORCE button to work - multiple methods
                decideButton.style.pointerEvents = 'auto';
                decideButton.style.cursor = 'pointer';
                
                // Remove any existing listeners
                const newButton = decideButton.cloneNode(true);
                decideButton.parentNode.replaceChild(newButton, decideButton);
                
                // Add fresh listener
                const freshButton = document.getElementById('decide-button');
                freshButton.addEventListener('click', (e) => {
                    console.log('🎯 REAL AI BUTTON CLICKED!');
                    e.preventDefault();
                    e.stopPropagation();
                    this.handleDecideClick();
                });
                
                // Force clickability
                freshButton.style.pointerEvents = 'auto';
                freshButton.style.cursor = 'pointer';
                
                console.log('✅ Real AI button setup complete');
            }

            const acceptBtn = document.getElementById('accept-btn');
            const tryAgainBtn = document.getElementById('try-again-btn');
            const insightsToggle = document.getElementById('insights-toggle');
            
            if (acceptBtn) {
                acceptBtn.addEventListener('click', () => this.handleAccept());
            }
            if (tryAgainBtn) {
                tryAgainBtn.addEventListener('click', () => this.handleTryAgain());
            }
            if (insightsToggle) {
                insightsToggle.addEventListener('click', () => this.toggleInsights());
            }

            // Listen for settings updates
            window.addEventListener('vfied-settings-updated', (event) => {
                console.log('⚙️ Settings updated event received:', event.detail);
                this.updatePreferences(getCurrentSettings());
            });
        }

        async handleDecideClick() {
            if (this.isThinking) return;
            
            console.log('🤖 Getting REAL AI suggestion with preferences:', this.userPreferences);
            
            this.startThinking();
            
            try {
                // REAL AI CALL
                const suggestion = await getAIQuickDecision({
                    includeRestaurants: true,
                    budget: 'medium',
                    userId: 'user_' + Date.now()
                });
                
                this.currentSuggestion = suggestion;
                this.showSuggestion(suggestion);
                this.stopThinking();
                
            } catch (error) {
                console.error('AI suggestion failed:', error);
                this.showError('AI service temporarily unavailable. Please try again.');
                this.stopThinking();
            }
        }

        startThinking() {
            this.isThinking = true;
            const button = document.getElementById('decide-button');
            const buttonText = document.getElementById('button-text');
            const buttonIcon = document.getElementById('button-icon');
            
            if (button) button.classList.add('thinking');
            if (buttonText) buttonText.textContent = 'AI THINKING...';
            if (buttonIcon) buttonIcon.textContent = '🤖';
            
            const locationText = this.userPreferences.location ? this.userPreferences.location.city : 'your area';
            this.updateContextInfo(`🧠 AI analyzing ${locationText}, weather, and your preferences...`);
        }

        stopThinking() {
            this.isThinking = false;
            const button = document.getElementById('decide-button');
            const buttonText = document.getElementById('button-text');
            const buttonIcon = document.getElementById('button-icon');
            
            if (button) button.classList.remove('thinking');
            if (buttonText) buttonText.textContent = 'DECIDE FOR ME';
            if (buttonIcon) buttonIcon.textContent = '🎯';
            
            // CRITICAL: Force button to stay clickable
            if (button) {
                button.style.pointerEvents = 'auto';
                button.style.cursor = 'pointer';
            }
        }

        showSuggestion(suggestion) {
            const suggestionResult = document.getElementById('suggestion-result');
            const resultEmoji = document.getElementById('result-emoji');
            const resultName = document.getElementById('result-name');
            const resultDescription = document.getElementById('result-description');
            const restaurantInfo = document.getElementById('restaurant-info');
            
            if (resultEmoji) resultEmoji.textContent = suggestion.food?.emoji || '🍽️';
            if (resultName) resultName.textContent = suggestion.food?.name || 'Great Choice!';
            if (resultDescription) resultDescription.textContent = suggestion.description || 'Perfect choice for you!';
            if (restaurantInfo) {
                restaurantInfo.textContent = suggestion.availabilityNote || 'Available in your area';
                restaurantInfo.style.display = 'block';
            }
            
            if (suggestionResult) {
                suggestionResult.classList.remove('hidden');
            }
            
            const locationText = suggestion.location || 'your area';
            const source = suggestion.source === 'mcp' ? 'AI+MCP' : 'AI';
            this.updateContextInfo(`🎉 ${source} found perfect choice for ${locationText}! How does this sound?`);
        }

        handleAccept() {
            console.log('✅ Accept clicked');
            alert('Great choice! Enjoy your meal! 🎉');
            
            const suggestionResult = document.getElementById('suggestion-result');
            if (suggestionResult) {
                suggestionResult.classList.add('hidden');
            }
            
            this.updateContextInfo('🎉 Decision made! Time to eat!');
        }

        handleTryAgain() {
            console.log('🔄 Try again clicked');
            
            const suggestionResult = document.getElementById('suggestion-result');
            if (suggestionResult) {
                suggestionResult.classList.add('hidden');
            }
            
            this.handleDecideClick();
        }

        toggleInsights() {
            const insightsContent = document.getElementById('insights-content');
            const toggle = document.getElementById('insights-toggle');
            
            if (insightsContent && toggle) {
                const isHidden = insightsContent.classList.contains('hidden');
                
                if (isHidden) {
                    insightsContent.classList.remove('hidden');
                    toggle.textContent = '🤖 Hide insights ↑';
                    
                    const culturalNote = document.getElementById('cultural-note');
                    const personalNote = document.getElementById('personal-note');
                    const weatherNote = document.getElementById('weather-note');
                    
                    if (this.currentSuggestion) {
                        if (culturalNote && this.currentSuggestion.culturalNote) {
                            culturalNote.innerHTML = `<strong>🌍 Cultural insight:</strong> ${this.currentSuggestion.culturalNote}`;
                            culturalNote.style.display = 'block';
                        }
                        if (personalNote && this.currentSuggestion.personalNote) {
                            personalNote.innerHTML = `<strong>🧠 Personal pattern:</strong> ${this.currentSuggestion.personalNote}`;
                            personalNote.style.display = 'block';
                        }
                        if (weatherNote && this.currentSuggestion.reason) {
                            weatherNote.innerHTML = `<strong>🎯 Why this works:</strong> ${this.currentSuggestion.reason}`;
                            weatherNote.style.display = 'block';
                        }
                    }
                } else {
                    insightsContent.classList.add('hidden');
                    toggle.textContent = '🤖 Why this choice? ↓';
                }
            }
        }

        showError(message) {
            this.updateContextInfo(`⚠️ ${message}`);
            setTimeout(() => {
                const locationText = this.userPreferences.location ? this.userPreferences.location.city : 'your area';
                this.updateContextInfo(`🤖 Ready to help with ${locationText} food suggestions`);
            }, 3000);
        }

        updateContextInfo(message) {
            const contextInfo = document.getElementById('context-info');
            if (contextInfo) {
                contextInfo.textContent = message;
            }
        }

        hideLoadingScreen() {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loadingScreen && mainApp) {
                    loadingScreen.style.opacity = '0';
                    loadingScreen.style.transition = 'opacity 0.5s ease';
                    
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        mainApp.classList.remove('hidden');
                        mainApp.style.opacity = '1';
                        
                        // Force button clickability after showing app
                        const button = document.getElementById('decide-button');
                        if (button) {
                            button.style.pointerEvents = 'auto';
                            button.style.cursor = 'pointer';
                        }
                    }, 500);
                }
            }, 2000);
        }
    }

    // ==================== INITIALIZATION ====================
    
    document.addEventListener('DOMContentLoaded', () => {
        console.log('⚙️ Initializing REAL AI VFIED system...');
        
        // Initialize settings first
        loadSettings();
        updateSettingsDisplay();
        setupSettingsPanel();
        
        // Make settings available globally
        window.vfiedUserSettings = {
            get: getCurrentSettings,
            update: updateSettingsDisplay,
            raw: () => userSettings,
            notify: notifyMainApp
        };
        
        // Initialize REAL AI app
        window.vfiedAppInstance = new VFIEDRealApp();
        
        // EMERGENCY button fix - runs every 3 seconds
        setInterval(() => {
            const btn = document.getElementById('decide-button');
            if (btn && !window.vfiedAppInstance?.isThinking) {
                btn.style.pointerEvents = 'auto';
                btn.style.cursor = 'pointer';
            }
        }, 3000);
        
        console.log('✅ REAL AI VFIED system ready - MCP + OpenAI integrated!');
    });
    </script>
</body>
</html>