System.register([],function(e,t){"use strict";return{execute:function(){var e=document.createElement("style");function t(e){const t=(e||"").toUpperCase();if(2!==t.length)return"üè≥Ô∏è";const n=127462;return String.fromCodePoint(n+(t.charCodeAt(0)-65))+String.fromCodePoint(n+(t.charCodeAt(1)-65))}e.textContent="*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;overflow-x:hidden;min-height:100vh}#app{min-height:100vh;display:flex;flex-direction:column}.loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;z-index:1000}.loading-content{text-align:center}.loading-content .logo{font-size:4rem;margin-bottom:1rem;animation:pulse 2s infinite}.loading-text{font-size:1.2rem;margin-bottom:2rem;opacity:.9}.loading-dots{display:flex;gap:.5rem;justify-content:center}.loading-dots span{width:8px;height:8px;background:rgba(255,255,255,.7);border-radius:50%;animation:bounce 1.4s infinite}.loading-dots span:nth-child(2){animation-delay:.2s}.loading-dots span:nth-child(3){animation-delay:.4s}.main-app{flex:1;display:flex;flex-direction:column;min-height:100vh;padding:0}.main-app.hidden{display:none}.status-bar-spacer{height:env(safe-area-inset-top,20px);background:transparent}.simple-header{text-align:center;padding:2rem 1rem 1rem;background:rgba(255,255,255,.1);backdrop-filter:blur(10px)}.app-title{font-size:2.5rem;font-weight:800;margin-bottom:.5rem;background:linear-gradient(45deg,#fff,#f0f0f0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.question{font-size:1.4rem;font-weight:300;margin-bottom:1rem;opacity:.9}.context-info{font-size:.9rem;padding:.5rem 1rem;background:rgba(255,255,255,.15);border-radius:20px;display:inline-block;backdrop-filter:blur(5px);opacity:.8;max-width:90%;transition:all .3s ease}.one-button-main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem 1rem;min-height:50vh}.decision-area{text-align:center;margin-bottom:2rem}.giant-decide-button{background:linear-gradient(145deg,#ff6b6b,#ee5a52);border:none;border-radius:30px;padding:2rem 3rem;box-shadow:0 20px 40px rgba(0,0,0,.2),0 8px 16px rgba(255,107,107,.3),inset 0 2px rgba(255,255,255,.2);cursor:pointer!important;transition:all .3s cubic-bezier(.175,.885,.32,1.275);transform:translateY(0);min-width:280px;position:relative;overflow:hidden;pointer-events:auto!important;z-index:10}.giant-decide-button:hover{transform:translateY(-5px);box-shadow:0 25px 50px rgba(0,0,0,.25),0 12px 24px rgba(255,107,107,.4),inset 0 2px rgba(255,255,255,.2)}.giant-decide-button:active{transform:translateY(-2px)}.button-icon{font-size:3rem;margin-bottom:.5rem;display:block;animation:gentle-bounce 2s infinite;pointer-events:none!important}.button-text{font-size:1.5rem;font-weight:800;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3);margin-bottom:.25rem;display:block;pointer-events:none!important}.button-subtitle{font-size:.9rem;color:rgba(255,255,255,.8);font-weight:400;pointer-events:none!important}.giant-decide-button.thinking{opacity:.8;animation:gentle-pulse 1.5s infinite;pointer-events:auto!important;cursor:pointer!important}.suggestion-result{width:100%;max-width:400px;margin-top:1rem;animation:fadeInUp .5s ease}.suggestion-result.hidden{display:none}.suggestion-card{background:rgba(255,255,255,.15);border-radius:20px;padding:2rem;text-align:center;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);margin-bottom:1.5rem}.food-emoji{font-size:4rem;margin-bottom:1rem;display:block}.food-name{font-size:1.8rem;font-weight:700;margin-bottom:.5rem;color:#fff}.food-description{font-size:1rem;opacity:.9;margin-bottom:1rem;line-height:1.4}.restaurant-info{font-size:.9rem;background:rgba(255,255,255,.1);padding:.5rem 1rem;border-radius:15px;display:inline-block;opacity:.8}.decision-actions{display:flex;gap:1rem;margin-bottom:1rem}.action-btn{flex:1;padding:1rem;border:none;border-radius:15px;font-size:1rem;font-weight:600;cursor:pointer!important;transition:all .3s ease;text-transform:uppercase;letter-spacing:.5px;pointer-events:auto!important}.action-btn.accept{background:linear-gradient(145deg,#27ae60,#229954);color:#fff;box-shadow:0 8px 16px rgba(39,174,96,.3)}.action-btn.accept:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(39,174,96,.4)}.action-btn.try-again{background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.3);backdrop-filter:blur(5px)}.action-btn.try-again:hover{background:rgba(255,255,255,.25);transform:translateY(-2px)}.ai-insights{margin-top:1rem}.insights-toggle{background:rgba(255,255,255,.1);border:none;color:#fff;padding:.75rem 1rem;border-radius:12px;font-size:.9rem;cursor:pointer!important;width:100%;transition:all .3s ease;backdrop-filter:blur(5px);pointer-events:auto!important}.insights-toggle:hover{background:rgba(255,255,255,.2)}.insights-content{margin-top:1rem;animation:fadeIn .3s ease}.insights-content.hidden{display:none}.cultural-note,.personal-note,.weather-note{background:rgba(255,255,255,.1);padding:1rem;border-radius:12px;margin-bottom:.5rem;font-size:.9rem;line-height:1.4;backdrop-filter:blur(5px)}.cultural-note strong,.personal-note strong,.weather-note strong{display:block;margin-bottom:.25rem}.simple-footer{text-align:center;padding:1rem;background:rgba(0,0,0,.1);backdrop-filter:blur(10px)}.stats-line{font-size:.9rem;opacity:.8;margin-bottom:.5rem}.ai-status{font-size:.8rem;opacity:.6}.bottom-safe-area{height:env(safe-area-inset-bottom,20px);background:rgba(0,0,0,.1)}.settings-panel{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:blur(20px);padding:2rem;border-radius:20px 20px 0 0;transform:translateY(100%);transition:transform .3s ease;z-index:100}.settings-panel:not(.hidden){transform:translateY(0)}.settings-content h3{color:#333;margin-bottom:1rem}.setting-item{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;color:#333;cursor:pointer}.close-settings{background:#667eea;color:#fff;border:none;padding:1rem 2rem;border-radius:12px;cursor:pointer;width:100%;font-weight:600}@keyframes pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}@keyframes gentle-bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-5px)}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes gentle-pulse{0%,to{opacity:.8}50%{opacity:.6}}@media (max-width: 480px){.simple-header{padding:1.5rem 1rem 1rem}.app-title{font-size:2rem}.question{font-size:1.2rem}.giant-decide-button{padding:1.5rem 2rem;min-width:240px}.button-text{font-size:1.3rem}.button-icon{font-size:2.5rem}.suggestion-card{padding:1.5rem}.food-name{font-size:1.5rem}.decision-actions{flex-direction:column}}@media (max-height: 600px){.one-button-main{padding:1rem;min-height:auto}.simple-header{padding:1rem}}@media (prefers-color-scheme: dark){.settings-panel{background:rgba(30,30,30,.95)}.settings-content h3,.setting-item{color:#fff}}.giant-decide-button:focus,.action-btn:focus,.insights-toggle:focus{outline:2px solid rgba(255,255,255,.5);outline-offset:2px}button,#decide-button{pointer-events:auto!important;cursor:pointer!important}#decide-button *{pointer-events:none!important}.giant-decide-button:disabled{pointer-events:auto!important;cursor:pointer!important;opacity:.8!important}.giant-decide-button,.action-btn,.insights-toggle{pointer-events:auto!important;cursor:pointer!important}.mood-section{margin-top:1.5rem;padding:1.5rem;background:rgba(255,255,255,.12);border-radius:20px;backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,.2);max-width:500px;margin-left:auto;margin-right:auto}.mood-section h3{font-size:1.1rem;margin-bottom:1rem;opacity:.9;display:flex;align-items:center;gap:.5rem;justify-content:center}.mood-input-container{display:flex;gap:.75rem;margin-bottom:1rem;flex-wrap:wrap}.mood-input{flex:1;min-width:250px;padding:1rem;border:2px solid rgba(255,255,255,.3);border-radius:15px;background:rgba(255,255,255,.15);color:#fff;font-size:1rem;backdrop-filter:blur(10px);transition:all .3s ease}.mood-input:focus{outline:none;border-color:rgba(255,255,255,.6);background:rgba(255,255,255,.2);transform:translateY(-1px)}.mood-input::placeholder{color:rgba(255,255,255,.7)}.mood-detect-btn{padding:1rem 1.5rem;background:linear-gradient(145deg,#28a745,#20c997);border:none;border-radius:15px;color:#fff;font-weight:600;cursor:pointer;transition:all .3s ease;white-space:nowrap;box-shadow:0 4px 15px rgba(40,167,69,.3);pointer-events:auto!important}.mood-detect-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(40,167,69,.4)}.mood-detect-btn:active{transform:translateY(0)}.mood-quick-options{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;margin-bottom:1rem}.mood-quick-btn{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);color:#fff;padding:.5rem 1rem;border-radius:20px;font-size:.85rem;cursor:pointer;transition:all .3s ease;backdrop-filter:blur(5px);pointer-events:auto!important}.mood-quick-btn:hover{background:rgba(255,255,255,.3);transform:translateY(-1px)}.detected-moods{animation:fadeInUp .5s ease;margin-top:1rem}.detected-moods.hidden{display:none}.mood-result{text-align:center;padding:1.5rem;background:rgba(255,255,255,.15);border-radius:15px;border:1px solid rgba(255,255,255,.3);backdrop-filter:blur(10px)}.mood-tags{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;margin:1rem 0}.mood-tag{background:linear-gradient(145deg,#667eea,#764ba2);color:#fff;padding:.5rem 1rem;border-radius:20px;font-size:.9rem;font-weight:600;box-shadow:0 2px 10px rgba(102,126,234,.3);animation:popIn .3s ease}.use-mood-btn{background:linear-gradient(145deg,#ff6b6b,#ee5a52);border:none;color:#fff;padding:.75rem 1.5rem;border-radius:12px;margin-top:1rem;cursor:pointer;font-weight:600;font-size:1rem;transition:all .3s ease;box-shadow:0 4px 15px rgba(255,107,107,.3);pointer-events:auto!important}.use-mood-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,107,107,.4)}.mood-error{color:#ff6b6b;text-align:center;padding:1rem;background:rgba(255,107,107,.1);border-radius:10px;border:1px solid rgba(255,107,107,.3)}.mood-loading{text-align:center;padding:1rem;color:rgba(255,255,255,.8)}.mood-context{background:rgba(102,126,234,.2);border-left:4px solid #667eea;padding:1rem;margin-bottom:1rem;border-radius:0 12px 12px 0;backdrop-filter:blur(5px)}.mood-match{font-size:.9rem;font-weight:600}@keyframes popIn{0%{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}@media (max-width: 480px){.mood-section{padding:1rem;margin-top:1rem}.mood-input-container{flex-direction:column;gap:.5rem}.mood-input{min-width:auto}.mood-quick-options{gap:.25rem}.mood-quick-btn{font-size:.8rem;padding:.4rem .8rem}.mood-tags{gap:.25rem}.mood-tag{font-size:.8rem;padding:.4rem .8rem}}@media (max-height: 600px){.mood-section{padding:1rem;margin-top:.5rem}}.mood-detect-btn:focus,.use-mood-btn:focus,.mood-quick-btn:focus{outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.mood-detect-btn,.mood-quick-btn,.use-mood-btn{pointer-events:auto!important;cursor:pointer!important}.tabs{display:flex;gap:8px;margin:12px 0 16px;border-bottom:1px solid #1f2937;padding-bottom:6px}.tab{background:#0b1220;border:1px solid #263247;color:#e2e8f0;padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}.tab.active{background:#6d28d9;border-color:#6d28d9;color:#fff}.tabpanel.hidden{display:none}.event-list{list-style:none;padding:0;margin:0;display:grid;gap:10px}.event-list li{background:#0b1220;border:1px solid #263247;border-radius:12px;padding:10px 12px}@media (max-width: 640px){.container{padding:0 12px}.grid-2{grid-template-columns:1fr!important}.row{flex-wrap:wrap}.card{padding:14px}button{width:100%}.tabs{overflow-x:auto}}#resultCard .result{word-break:break-word}.mood-chip{transition:transform .04s ease}.mood-chip.active{outline:2px solid #6d28d9;transform:translateY(-1px)}button[disabled]{opacity:.6;cursor:not-allowed}.events-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media (max-width: 700px){.events-grid{grid-template-columns:1fr}}.event-card{background:#0b1220;border:1px solid #263247;border-radius:14px;padding:12px;display:flex;gap:10px;align-items:flex-start}.event-badge{font-size:22px;line-height:1}.event-body{flex:1}.event-title{font-weight:700}.event-meta{font-size:12px;opacity:.8;margin-top:4px}.event-cta{margin-top:8px;display:flex;gap:8px}.travel-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media (max-width: 700px){.travel-grid{grid-template-columns:1fr}}.travel-card{background:#0b1220;border:1px solid #263247;border-radius:14px;padding:12px;display:flex;gap:10px;align-items:flex-start}.travel-emoji{font-size:22px;line-height:1}.travel-body{flex:1}.travel-title{font-weight:700}.travel-note{font-size:12px;opacity:.85;margin-top:2px}.travel-cta{margin-top:8px;display:flex;gap:8px}.tab-btn.active{outline:2px solid #6d28d9}.tab-panel .event-card,.tab-panel .travel-card{display:flex;gap:12px;background:#0b1220;border:1px solid #263247;padding:12px;border-radius:12px;align-items:flex-start}.event-badge,.travel-badge{font-size:24px}.event-title,.travel-title{font-weight:700}.event-meta{font-size:12px;opacity:.8}.timeline{border-left:2px solid #263247;margin-left:6px;padding-left:10px}.timeline .step{margin:8px 0}.timeline .time{font-weight:700;margin-right:6px}\n/*$vite$:1*/",document.head.appendChild(e);const n="http://localhost:3001",o="demo_growth_key_456",a=document.getElementById("moodInput"),i=document.getElementById("decideBtn"),r=document.getElementById("detectMoodBtn"),d=document.getElementById("countrySelect"),s=document.getElementById("citySelect"),c=document.getElementById("latInput"),l=document.getElementById("lngInput"),m=document.getElementById("budgetSelect"),p=document.getElementById("resultCard"),g=document.getElementById("foodEmoji"),u=document.getElementById("foodName");document.getElementById("foodType");const f=document.getElementById("friendMessage");document.getElementById("reasoning"),document.getElementById("culturalNote"),document.getElementById("dietaryNote"),document.getElementById("weatherNote"),document.getElementById("countryCode"),document.getElementById("confidence"),document.getElementById("weatherBadge");const y=document.getElementById("menuTextarea"),b=document.getElementById("uploadMenuBtn"),h=document.getElementById("viewMenuBtn"),v=document.getElementById("menuResponse"),x=document.getElementById("dietaryChips"),w=document.getElementById("selectedFlag"),k=["vegetarian","vegan","gluten-free","dairy-free","keto","halal","kosher","nut-free","paleo","pescatarian"];let $=null;const E={get(e,t=null){try{return JSON.parse(localStorage.getItem(e))??t}catch{return t}},set(e,t){localStorage.setItem(e,JSON.stringify(t))}},I=document.getElementById("cityInputFree");let B=null;const C=document.querySelectorAll(".tab-btn"),L=document.querySelectorAll(".tab-panel");function T(e){const t=document.getElementById("decideBtn");t&&(t.disabled=!!e,t.textContent=e?"ü§ñ Thinking...":"üéØ Decide For Me",t.setAttribute("aria-busy",e?"true":"false"))}function S(e){document.querySelectorAll(".tab").forEach(t=>{const n=t.dataset.tab===e;t.classList.toggle("active",n),t.setAttribute("aria-selected",n?"true":"false")}),document.querySelectorAll(".tabpanel").forEach(t=>{t.classList.toggle("hidden",t.id!==`tab-${e}`)})}function j(){return Array.from(x.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value)}function N(){const e=document.getElementById("countrySelect"),t=document.getElementById("citySelect");let n={city:"London",country:"United Kingdom",country_code:"GB"};try{if(e&&e.value){const t=JSON.parse(e.value);n={city:"",country:t.name||t.country||"",country_code:t.code||t.country_code||""}}else t&&t.value&&(n=JSON.parse(t.value))}catch(r){console.warn("getLocation() parse failed, using default:",r)}const o=I?.value?.trim();o&&(n.city=o);const a=parseFloat(c?.value??""),i=parseFloat(l?.value??"");return Number.isNaN(a)||Number.isNaN(i)||(n.latitude=a,n.longitude=i),n}C.forEach(e=>e.addEventListener("click",()=>{const t=e.dataset.tab;C.forEach(t=>t.classList.toggle("active",t===e)),L.forEach(e=>e.style.display=e.id===`tab-${t}`?"block":"none")})),document.addEventListener("click",e=>{const t=e.target.closest(".tab");t&&S(t.dataset.tab)}),document.addEventListener("DOMContentLoaded",()=>{S("food");const e=E.get("vfied:lastPayload"),t=E.get("vfied:mood"),n=E.get("vfied:dietary",[]),o=E.get("vfied:budget"),a=E.get("vfied:city");a&&I&&(I.value=a),t&&(document.getElementById("moodInput").value=t),n?.length&&n.forEach(e=>{const t=document.querySelector(`#dietaryChips input[value="${e}"]`);t&&(t.checked=!0)}),o&&(m.value=o);try{const t=e?.location?.country_code,n=document.getElementById("citySelect");if(t&&n)for(const e of n.options)if(JSON.parse(e.value).country_code===t){n.value=e.value;break}}catch{}}),x.innerHTML="",k.forEach(e=>{const t=`diet_${e}`,n=document.createElement("label");n.className="chip",n.innerHTML=`<input type="checkbox" id="${t}" value="${e}"><span>${e}</span>`,x.appendChild(n)}),a?.addEventListener("input",e=>E.set("vfied:mood",e.target.value)),m?.addEventListener("change",e=>E.set("vfied:budget",e.target.value)),x?.addEventListener("change",()=>{const e=Array.from(x.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value);E.set("vfied:dietary",e)}),s?.addEventListener("change",e=>{try{const t=JSON.parse(e.target.value);E.set("vfied:location",t)}catch{}}),I?.addEventListener("input",e=>E.set("vfied:city",e.target.value)),document.addEventListener("DOMContentLoaded",async function(){const e=document.getElementById("countrySelect");if(e)try{const t=await fetch(`${n}/v1/countries`),o=await t.json();if(!o?.countries?.length)return;e.innerHTML='<option value="" disabled selected>Select your country</option>'+o.countries.map(e=>`<option value='${JSON.stringify(e)}'>${e.name}</option>`).join("")}catch(t){console.warn("Countries failed",t)}}),d?.addEventListener("change",()=>{try{const e=JSON.parse(d.value);w&&(w.textContent=t(e.code||e.country_code))}catch{}}),document.getElementById("quickMoods")?.addEventListener("click",e=>{const t=e.target.closest(".mood-chip");if(!t)return;document.querySelectorAll(".mood-chip").forEach(e=>e.classList.remove("active")),t.classList.add("active");const n={tired:"tired and need something comforting",stressed:"stressed but want something light",celebrating:"celebrating a small win",hungry:"very hungry and need food fast"}[t.dataset.quick]||t.dataset.quick;document.getElementById("moodInput").value=n}),r&&r.addEventListener("click",()=>{a.value.trim()||(a.value="stressed but want something light"),r.textContent="üß† Mood understood!",setTimeout(()=>r.textContent="‚ú® Detect Mood (AI)",1200)}),i?.addEventListener("click",async()=>{const e=(document.getElementById("moodInput")?.value||"").trim()||"hungry",o=N(),a=document.getElementById("dietaryChips"),i=a?Array.from(a.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value):[],r=document.getElementById("budgetSelect")?.value||"medium";B={location:o,mood_text:e,dietary:i,budget:r,menu_source:"global_database"},E.set("vfied:lastPayload",B),T(!0);try{const e=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}),a=await e.text(),r=JSON.parse(a);if(!e.ok||!r?.success)throw new Error(r?.error||`HTTP ${e.status}`);const d=(e,t)=>{const n=document.getElementById(e);n&&(n.textContent=t)},s=r.food||{};d("foodEmoji",s.emoji||"üçΩÔ∏è"),d("foodName",s.name||"Great Choice"),d("friendMessage",r.friendMessage||r.description||""),d("reasoning",r.reasoning||r.reason||""),d("culturalNote",r.culturalNote||""),d("dietaryNote",r.dietaryNote||"‚Äî"),d("weatherNote",r.weatherNote||r.weatherReasoning||"‚Äî"),d("countryCode",s.country_code?t(s.country_code):"‚Äî"),d("confidence","number"==typeof r.confidence?`Confidence: ${r.confidence}%`:"Confidence: ‚Äî"),d("weatherBadge",r?.weather?.description||r?.weather&&null!=r.weather.temperature?`Weather: ${r.weather.temperature??"‚Äî"}¬∞C ‚Ä¢ ${r.weather.description??r.weather.condition??""}`.trim():"Weather: ‚Äî");const c=document.getElementById("engineBadge");c&&(c.textContent="gpt"===r.source||"ai"===r.context?.mood_detection_method?"Engine: GPT":"uploaded_menu"===r.source?"Engine: Vendor Menu":"Engine: Fallback"),document.getElementById("resultCard").style.display="block",fetch(`${n}/v1/telemetry`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"decide_success",payload:{location:o,dietary:i}})}).catch(()=>{})}catch(d){console.error(d),alert(`Error: ${d.message}`)}finally{T(!1)}}),document.getElementById("loadEventsBtn")?.addEventListener("click",async()=>{const e=document.getElementById("eventsGrid");if(!e)return;const t=N(),o=`${n}/v1/events?city=${encodeURIComponent(t.city||"")}&country_code=${encodeURIComponent(t.country_code||"")}`;e.innerHTML='<div class="muted">Loading events‚Ä¶</div>';try{const a=await fetch(o),i=await a.json(),r=i?.events||[];if(!r.length)return void(e.innerHTML='<div class="muted">No events found.</div>');e.innerHTML=r.map(e=>{const o="KE"===t.country_code?"Try Nyama Choma nearby.":"GB"===t.country_code?"Pair with fish & chips.":"JP"===t.country_code?"Grab ramen after.":"Find a local favorite.";return`\n        <div class="event-card">\n          <div class="event-badge">${"music"===e.tag?"üé∂":"food"===e.tag?"üç¢":"üé¨"}</div>\n          <div class="event-body">\n            <div class="event-title">${e.title}</div>\n            <div class="event-meta">${e.when} ‚Äî ${e.city} ${e.country_code}</div>\n            <div class="event-meta">${o}</div>\n            <div class="event-cta">\n              <a class="small secondary" href="${n}/v1/linkout?tag=event&url=${encodeURIComponent(`https://www.google.com/search?q=${encodeURIComponent(`${e.title} ${e.city}`)}`)}" target="_blank" rel="noopener">Book (demo)</a>\n              <button class="small" onclick="document.getElementById('decideBtn').scrollIntoView({behavior:'smooth'});">Suggest food</button>\n            </div>\n          </div>\n        </div>`}).join(""),fetch(`${n}/v1/telemetry`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"events_view",payload:{city:t.city,code:t.country_code}})}).catch(()=>{})}catch(a){e.innerHTML='<div class="muted">Failed to load events.</div>'}}),document.getElementById("loadTravelBtn")?.addEventListener("click",async()=>{const e=document.getElementById("travelGrid"),t=document.getElementById("travelIntro");if(!e)return;const o=N(),a=`${n}/v1/travel/highlights?city=${encodeURIComponent(o.city||"")}&country_code=${encodeURIComponent(o.country_code||"")}`;e.innerHTML='<div class="muted">Loading must-try‚Ä¶</div>',t.textContent="";try{const i=await fetch(a),r=await i.json();t.textContent=r?.intro||"";const d=r?.dishes||[];if(!d.length)return void(e.innerHTML='<div class="muted">No highlights yet.</div>');e.innerHTML=d.map(e=>`\n      <div class="travel-card">\n        <div class="travel-emoji">${e.emoji||"üçΩÔ∏è"}</div>\n        <div class="travel-body">\n          <div class="travel-title">${e.name}</div>\n          <div class="travel-note">${e.note||""}</div>\n          <div class="travel-cta">\n            <button class="small" data-suggest='${encodeURIComponent(JSON.stringify(e))}'>Suggest this</button>\n            <button class="small" onclick="window.open('${n}/v1/linkout?tag=maps&url=${encodeURIComponent(`https://www.google.com/maps/search/${encodeURIComponent(`${e.name} ${o.city||""}`)}`)}}','_blank','noopener')">Open in Maps</button>\n          </div>\n        </div>\n      </div>\n    `).join("")}catch(i){e.innerHTML='<div class="muted">Failed to load highlights.</div>'}}),document.getElementById("tab-travel")?.addEventListener("click",async e=>{const t=e.target.closest("button[data-suggest]");if(t)try{const e=JSON.parse(decodeURIComponent(t.dataset.suggest)),o=N(),a={location:o,mood_text:`I want to try ${e.name}`,dietary:[],budget:"medium",menu_source:"global_database"};document.getElementById("decideBtn")?.scrollIntoView({behavior:"smooth",block:"center"});const i=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await i.json();if(!i.ok||!r?.success)throw new Error(r?.error||`HTTP ${i.status}`);document.getElementById("resultCard").style.display="block",document.getElementById("foodEmoji").textContent=r.food?.emoji||e.emoji||"üçΩÔ∏è",document.getElementById("foodName").textContent=r.food?.name||e.name,document.getElementById("friendMessage").textContent=r.friendMessage||`Great pick for ${o.city||"your trip"}!`}catch(o){alert("Could not suggest this item.")}}),document.getElementById("acceptBtn").addEventListener("click",()=>{alert("‚úÖ Saved! Enjoy your meal."),p.style.display="none"}),document.getElementById("tryAgainBtn")?.addEventListener("click",async()=>{const e=document.getElementById("tryAgainBtn");e.disabled=!0,T(!0);try{const e=B||{location:N(),mood_text:a?.value||"hungry",dietary:j?j():[],budget:m?.value||"medium",menu_source:"global_database"},t=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await t.json();if(!t.ok||!o?.success)throw new Error(o?.error||`HTTP ${t.status}`);document.getElementById("resultCard").style.display="block",document.getElementById("foodEmoji").textContent=o.food?.emoji||"üçΩÔ∏è",document.getElementById("foodName").textContent=o.food?.name||"Great Choice",document.getElementById("friendMessage").textContent=o.friendMessage||""}catch(t){alert(`Error: ${t.message}`)}finally{T(!1),e.disabled=!1}}),b.addEventListener("click",async()=>{try{const e=JSON.parse(y.value),t=await fetch(`${n}/v1/menus`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({mode:"snapshot",menu:e})}),a=await t.json();if(!t.ok)throw new Error(a.error||"Upload failed");const i=a.summary?.accepted??0,r=a.summary?.total??e.length,d=Array.isArray(e)?e.map(e=>e.name).filter(Boolean).join(", "):"";v.textContent=`‚úÖ Menu uploaded (accepted ${i}/${r})\nversion: ${a.menu_version}\n`+(d?`items: ${d}\n`:"")+(a.errors?.length?`errors: ${JSON.stringify(a.errors,null,2)}`:"");const s=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({menu_source:"my_uploaded_menu"})}),c=await s.json();v.textContent+=`\n\nSuggestion ‚Üí ${c?.food?.name||"n/a"} ${c?.food?.emoji||""}`}catch(e){v.textContent=`‚ùå ${e.message}`}}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(e=>console.warn("SW reg failed",e))}),h.addEventListener("click",async()=>{try{const e=await fetch(`${n}/v1/menus`,{headers:{Authorization:`Bearer ${o}`}}),t=await e.json();v.textContent=JSON.stringify(t,null,2)}catch(e){v.textContent=`Error: ${e.message}`}});let _=null;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),_=e;const t=document.getElementById("installBanner");t&&(t.style.display="block")}),document.getElementById("installBtn")?.addEventListener("click",async()=>{_&&(_.prompt(),await _.userChoice,_=null,document.getElementById("installBanner").style.display="none")}),document.getElementById("installClose")?.addEventListener("click",()=>{document.getElementById("installBanner").style.display="none"});const M=document.getElementById("eventsGrid"),z=document.getElementById("loadEventsBtn");z?.addEventListener("click",async()=>{const e=N();M.innerHTML='<div class="muted">Loading‚Ä¶</div>';try{const t=await fetch(`${n}/v1/events?city=${encodeURIComponent(e.city||"")}&country_code=${encodeURIComponent(e.country_code||"")}`),o=await t.json(),a=o?.events||[];if(!a.length)return void(M.innerHTML='<div class="muted">No events found.</div>');M.innerHTML=a.map(e=>{const t="music"===e.tag?"üé∂":"food"===e.tag?"üç¢":"üé¨",o="music"===e.tag?"celebrating":"food"===e.tag?"adventurous":"relax",a=`https://www.google.com/search?q=${encodeURIComponent(`${e.title} ${e.city}`)}`,i=`${n}/v1/linkout?tag=event&url=${encodeURIComponent(a)}`;return`\n        <div class="event-card">\n          <div class="event-badge">${t}</div>\n          <div class="event-body">\n            <div class="event-title">${e.title}</div>\n            <div class="event-meta">${e.when} ‚Äî ${e.city} ${e.country_code}</div>\n            <div class="row" style="gap:8px; margin-top:6px">\n              <button class="small" data-suggest-mood="${o}">Suggest food for this</button>\n              <a class="small secondary" href="${i}" target="_blank" rel="noopener">Book (demo)</a>\n            </div>\n          </div>\n        </div>`}).join("")}catch{M.innerHTML='<div class="muted">Failed to load events.</div>'}}),M?.addEventListener("click",async e=>{const t=e.target.closest("button[data-suggest-mood]");if(!t)return;const o=N(),a=`I'm ${t.dataset.suggestMood} and want something local`;T(!0);try{const e=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:o,mood_text:a,dietary:j(),budget:m?.value||"medium"})}),t=await e.json();t?.success&&(p.style.display="block",g.textContent=t.food?.emoji||"üçΩÔ∏è",u.textContent=t.food?.name||"Great Choice",f.textContent=t.friendMessage||"")}finally{T(!1)}});const O=document.getElementById("travelGrid"),P=document.getElementById("loadTravelBtn");P?.addEventListener("click",async()=>{const e=N();O.innerHTML='<div class="muted">Loading‚Ä¶</div>';try{const t=await fetch(`${n}/v1/travel/highlights?city=${encodeURIComponent(e.city||"")}&country_code=${encodeURIComponent(e.country_code||"")}`),o=await t.json(),a=o?.highlights||[];if(!a.length)return void(O.innerHTML='<div class="muted">No highlights yet.</div>');O.innerHTML=a.map(t=>{const o=`https://www.google.com/maps/search/${encodeURIComponent(`${t.name} ${e.city||""}`)}`,a=`${n}/v1/linkout?tag=maps&url=${encodeURIComponent(o)}`;return`\n        <div class="travel-card">\n          <div class="travel-badge">${t.emoji||"üó∫Ô∏è"}</div>\n          <div class="travel-body">\n            <div class="travel-title">${t.name}</div>\n            <div class="muted">${t.desc||""}</div>\n            <div class="row" style="gap:8px; margin-top:6px">\n              <button class="small" data-suggest-food="${t.name}">Suggest food near here</button>\n              <a class="small secondary" href="${a}" target="_blank" rel="noopener">Open in Maps</a>\n            </div>\n          </div>\n        </div>`}).join("")}catch{O.innerHTML='<div class="muted">Failed to load highlights.</div>'}});const A=document.getElementById("copyPlanBtn");function J(e){const t=document.createElement("div");t.textContent=e,t.style.position="fixed",t.style.bottom="16px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="#0b1220",t.style.border="1px solid #263247",t.style.padding="10px 14px",t.style.borderRadius="10px",t.style.color="#e2e8f0",t.style.fontSize="14px",t.style.zIndex="9999",t.style.boxShadow="0 8px 24px rgba(0,0,0,.35)",document.body.appendChild(t),setTimeout(()=>t.remove(),1500)}A?.addEventListener("click",async()=>{try{let e="";if($&&($.timeline||$.plan||$.planTitle)){const t=$.city||"",n=$.planTitle||"Local Night Plan"+(t?" ‚Äî "+t:""),o=Array.isArray($.timeline)?$.timeline:[],a=Array.isArray($.tips)?$.tips:[],i=[];i.push(n),i.push(""),o.forEach(e=>{const t=e.time?`${e.time} `:"",n=e.activity||e.title||"",o=e.emoji?`${e.emoji} `:"";i.push(`${t}${o}${n}`.trim()),e.food&&i.push(`  ‚Ä¢ Food: ${e.food}`),e.note&&i.push(`  ‚Ä¢ ${e.note}`),e.link&&i.push(`  ‚Ä¢ Link: ${e.link}`),i.push("")}),a.length&&(i.push("Tips:"),a.forEach(e=>i.push(`  ‚Ä¢ ${e}`))),e=i.join("\n")}else{const t=document.getElementById("planBox");e=t?t.innerText.trim():"Night plan"}if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e),J("‚úÖ Plan copied to clipboard");else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),J("‚úÖ Plan copied")}}catch(e){alert("Could not copy plan: "+e.message)}}),O?.addEventListener("click",async e=>{const t=e.target.closest("button[data-suggest-food]");if(!t)return;const o=N(),a=`I want something near ${t.dataset.suggestFood}, authentic and local.`;T(!0);try{const e=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:o,mood_text:a,dietary:j(),budget:m?.value||"medium"})}),t=await e.json();t?.success&&(p.style.display="block",g.textContent=t.food?.emoji||"üçΩÔ∏è",u.textContent=t.food?.name||"Great Choice",f.textContent=t.friendMessage||"")}finally{T(!1)}});const U=document.getElementById("genPlanBtn"),H=document.getElementById("planPrompt"),R=document.getElementById("planBox");U?.addEventListener("click",async()=>{const e=N(),t=H?.value?.trim()||"I want to try local experiences in the city tonight. Map a night plan with food and vibes.";R.innerHTML='<div class="muted">Planning your night‚Ä¶</div>';try{const o=await fetch(`${n}/v1/travel/plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:e,prompt:t})}),a=await o.json();if($=a,!a?.success&&!a?.timeline)throw new Error("No plan");const i=(a.timeline||[]).map(e=>{const t=e.link?`${n}/v1/linkout?tag=plan&url=${encodeURIComponent(e.link)}`:null;return`\n        <div class="step">\n          <span class="time">${e.time||""}</span>\n          <span class="act">${e.emoji||""} ${e.activity||""}</span>\n          ${e.food?`<div class="muted">Food: ${e.food}</div>`:""}\n          ${e.note?`<div class="muted">${e.note}</div>`:""}\n          ${t?`<div><a class="small" href="${t}" target="_blank" rel="noopener">Open link</a></div>`:""}\n        </div>`}).join("");R.innerHTML=`\n      <div class="big" style="margin-bottom:6px">${a.planTitle||"Local Night Plan"}</div>\n      <div class="timeline">${i}</div>\n      ${Array.isArray(a.tips)&&a.tips.length?`\n      <div style="margin-top:8px">\n        <div class="event-title">Tips</div>\n        <ul>${a.tips.map(e=>`<li>${e}</li>`).join("")}</ul>\n      </div>`:""}\n    `}catch(o){R.innerHTML=`<div class="muted">Couldn't generate a plan: ${o.message}</div>`}});const q=document.getElementById("genNightPlanBtn");q?.addEventListener("click",async()=>{const e=N();R.innerHTML='<div class="muted">Planning your night‚Ä¶</div>';try{const t=await fetch(`${n}/v1/travel/nightplan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:e})}),o=await t.json();if($=o,!o?.success&&!o?.timeline)throw new Error("No plan generated");const a=(o.timeline||[]).map((e,t)=>{const o=e.link?`${n}/v1/linkout?tag=nightplan&url=${encodeURIComponent(e.link)}`:null,a={time:e.time||"",activity:e.activity||"",food:e.food||"",emoji:e.emoji||"",note:e.note||""},i=encodeURIComponent(JSON.stringify(a));return`\n        <div class="step">\n          <div class="big">${e.time||""} ${e.emoji||""} ${e.activity||""}</div>\n          ${e.food?`<div>Food: <strong>${e.food}</strong></div>`:""}\n          ${e.note?`<div class="muted">${e.note}</div>`:""}\n          <div class="row" style="gap:8px; margin-top:4px">\n            <button class="small suggest-step-btn" data-step='${i}'>Suggest food for this step</button>\n            ${o?`<a class="small secondary" href="${o}" target="_blank" rel="noopener">Open link</a>`:""}\n          </div>\n        </div>`}).join("");R.innerHTML=`\n      <div class="big">${o.planTitle||`Local Night Plan in ${o.city||""}`}</div>\n      <div class="timeline" style="margin-top:6px">${a}</div>\n      ${Array.isArray(o.tips)&&o.tips.length?`<div style="margin-top:10px"><div class="event-title">Tips</div><ul>${o.tips.map(e=>`<li>${e}</li>`).join("")}</ul></div>`:""}\n    `}catch(t){R.innerHTML=`<div class="muted">Couldn't generate a plan: ${t.message}</div>`}}),R?.addEventListener("click",async e=>{const o=e.target.closest(".suggest-step-btn");if(!o)return;let a={};try{a=JSON.parse(decodeURIComponent(o.dataset.step||"%7B%7D"))}catch{}const i=N(),r=(a.activity||"").toLowerCase(),d=(a.food||"").toLowerCase();let s="local, authentic, balanced";/walk|market|stroll|crawl|night/i.test(r)&&(s="adventurous street-food vibes"),/jazz|music|bar|pub|live/i.test(r)&&(s="celebrating with light bites"),/dinner|signature|restaurant|hearty/i.test(r)&&(s="comforting, authentic, hearty"),/dessert|sweet|ice cream|gelato/i.test(r)&&(s="sweet finish, light and fun"),d&&(s+=`, inspired by ${a.food}`);const c=o.textContent;o.disabled=!0,o.textContent="Thinking‚Ä¶";try{const e=await fetch(`${n}/v1/recommend`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:i,mood_text:s,dietary:j(),budget:m?.value||"medium",menu_source:"global_database"})}),o=await e.json();if(!o?.success)throw new Error(o?.error||"No suggestion");p&&(p.style.display="block"),g&&(g.textContent=o.food?.emoji||"üçΩÔ∏è"),u&&(u.textContent=o.food?.name||"Great Choice"),f&&(f.textContent=o.friendMessage||`Because this step is "${a.activity}"`);const r=(e,t)=>{const n=document.getElementById(e);n&&(n.textContent=t)};r("dietaryNote",o.dietaryNote||"‚Äî"),r("weatherNote",o.weatherNote||o.weatherReasoning||"‚Äî"),r("countryCode",o.food?.country_code?t(o.food.country_code):"‚Äî"),r("confidence","number"==typeof o.confidence?`Confidence: ${o.confidence}%`:"Confidence: ‚Äî"),r("weatherBadge",o?.weather?.description||o?.weather&&null!=o.weather.temperature?`Weather: ${o.weather.temperature??"‚Äî"}¬∞C ‚Ä¢ ${o.weather.description??o.weather.condition??""}`.trim():"Weather: ‚Äî");const d=document.getElementById("engineBadge");d&&(d.textContent="gpt"===o.source||"ai"===o.context?.mood_detection_method?"Engine: GPT":"uploaded_menu"===o.source?"Engine: Vendor Menu":"Engine: Fallback")}catch(l){alert(`Couldn't suggest for this step: ${l.message}`)}finally{o.disabled=!1,o.textContent=c}})}}});
//# sourceMappingURL=index-legacy-D4SkA3HI.js.map
