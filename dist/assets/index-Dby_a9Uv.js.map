{"version":3,"file":"index-Dby_a9Uv.js","sources":["../../src/utils/helpers.js","../../src/main.js"],"sourcesContent":["export function countryCodeToEmoji(cc) {\n    const code = (cc || \"\").toUpperCase();\n    if (code.length !== 2) return \"🏳️\";\n    const A = 0x1F1E6;\n    return String.fromCodePoint(A + (code.charCodeAt(0) - 65))\n         + String.fromCodePoint(A + (code.charCodeAt(1) - 65));\n  }\n  ","import { getCountries, getFoodSuggestion } from \"./services/foodService.js\";\nimport { countryCodeToEmoji } from \"./utils/helpers.js\";\n\n// ------------------ CONFIG ------------------\nconst SERVER = import.meta.env.VITE_MCP_SERVER_URL || 'https://vfied-v3.onrender.com';\nconst API_KEY = 'demo_growth_key_456'; // demo vendor key for upload endpoints\n\n// ------------------ ELEMENTS ------------------\nconst moodInput = document.getElementById('moodInput');\nconst decideBtn = document.getElementById('decideBtn');\nconst detectMoodBtn = document.getElementById('detectMoodBtn');\nconst countrySelect = document.getElementById('countrySelect');\nconst citySelect = document.getElementById('citySelect'); // optional city select\nconst latInput = document.getElementById('latInput');\nconst lngInput = document.getElementById('lngInput');\nconst budgetSelect = document.getElementById('budgetSelect');\n\nconst resultCard = document.getElementById('resultCard');\nconst foodEmoji = document.getElementById('foodEmoji');\nconst foodName = document.getElementById('foodName');\nconst foodType = document.getElementById('foodType');\nconst friendMessage = document.getElementById('friendMessage');\nconst reasoning = document.getElementById('reasoning');\nconst culturalNote = document.getElementById('culturalNote');\nconst dietaryNote = document.getElementById('dietaryNote');\nconst weatherNote = document.getElementById('weatherNote');\nconst countryCode = document.getElementById('countryCode');\nconst confidence = document.getElementById('confidence');\nconst weatherBadge = document.getElementById('weatherBadge');\n\nconst menuTextarea = document.getElementById('menuTextarea');\nconst uploadMenuBtn = document.getElementById('uploadMenuBtn');\nconst viewMenuBtn = document.getElementById('viewMenuBtn');\nconst menuResponse = document.getElementById('menuResponse');\nconst chipsWrap = document.getElementById('dietaryChips');\nconst selectedFlag = document.getElementById('selectedFlag');\n\nconst DIETARY = [\n  'vegetarian','vegan','gluten-free','dairy-free','keto','halal',\n  'kosher','nut-free','paleo','pescatarian'\n];\nlet lastPlanData = null; // holds the most recent plan JSON\nconst LS = {\n  get(k, d=null){ try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } },\n  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }\n};\nconst cityInputFree = document.getElementById('cityInputFree');\nlet lastPayload = null;\n\nconst tabBtns = document.querySelectorAll('.tab-btn');\nconst panels  = document.querySelectorAll('.tab-panel');\ntabBtns.forEach(btn => btn.addEventListener('click', () => {\n  const name = btn.dataset.tab;\n  tabBtns.forEach(b => b.classList.toggle('active', b === btn));\n  panels.forEach(p => p.style.display = p.id === `tab-${name}` ? 'block' : 'none');\n}));\n\nfunction setThinking(on) {\n  const btn = document.getElementById('decideBtn');\n  if (!btn) return;\n  btn.disabled = !!on;\n  btn.textContent = on ? '🤖 Thinking...' : '🎯 Decide For Me';\n  btn.setAttribute('aria-busy', on ? 'true' : 'false');\n}\n\nfunction activateTab(name) {\n  document.querySelectorAll('.tab').forEach(btn => {\n    const isActive = btn.dataset.tab === name;\n    btn.classList.toggle('active', isActive);\n    btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\n  });\n  document.querySelectorAll('.tabpanel').forEach(panel => {\n    panel.classList.toggle('hidden', panel.id !== `tab-${name}`);\n  });\n}\ndocument.addEventListener('click', (e) => {\n  const btn = e.target.closest('.tab');\n  if (!btn) return;\n  activateTab(btn.dataset.tab);\n});\ndocument.addEventListener('DOMContentLoaded', () => {\n  activateTab('food');\n  \n  // Restore saved user preferences\n  const last = LS.get('vfied:lastPayload');\n  const mood = LS.get('vfied:mood');\n  const diet = LS.get('vfied:dietary', []);\n  const budg = LS.get('vfied:budget');\n  const savedCity = LS.get('vfied:city'); \n  \n  if(savedCity && cityInputFree) cityInputFree.value = savedCity;\n\n  if (mood) document.getElementById('moodInput').value = mood;\n  if (diet?.length) {\n    diet.forEach(v => {\n      const el = document.querySelector(`#dietaryChips input[value=\"${v}\"]`);\n      if (el) el.checked = true;\n    });\n  }\n  if (budg) { budgetSelect.value = budg; }\n\n  // If you're using #citySelect with JSON options, try to match country_code\n  try {\n    const code = last?.location?.country_code;\n    const sel = document.getElementById('citySelect');\n    if (code && sel) {\n      for (const opt of sel.options) {\n        const val = JSON.parse(opt.value);\n        if (val.country_code === code) { sel.value = opt.value; break; }\n      }\n    }\n  } catch {}\n});\n// ------------------ RENDER ------------------\nfunction renderChips() {\n  chipsWrap.innerHTML = '';\n  DIETARY.forEach(tag => {\n    const id = `diet_${tag}`;\n    const chip = document.createElement('label');\n    chip.className = 'chip';\n    chip.innerHTML = `<input type=\"checkbox\" id=\"${id}\" value=\"${tag}\"><span>${tag}</span>`;\n    chipsWrap.appendChild(chip);\n  });\n}\nrenderChips();\n\n// Add after line 45 (after renderChips();):\n// Save on change\nmoodInput?.addEventListener('input', e => LS.set('vfied:mood', e.target.value));\nbudgetSelect?.addEventListener('change', e => LS.set('vfied:budget', e.target.value));\n\n// Save dietary on change\nchipsWrap?.addEventListener('change', () => {\n  const vals = Array.from(chipsWrap.querySelectorAll('input[type=\"checkbox\"]:checked')).map(x => x.value);\n  LS.set('vfied:dietary', vals);\n});\n\n// Save location (citySelect holds JSON per option)\ncitySelect?.addEventListener('change', e => {\n  try {\n    const val = JSON.parse(e.target.value);\n    LS.set('vfied:location', val);\n  } catch {}\n});\n// Add after existing save handlers:\ncityInputFree?.addEventListener('input', e => LS.set('vfied:city', e.target.value));\nfunction getSelectedDietary() {\n  return Array.from(chipsWrap.querySelectorAll('input[type=\"checkbox\"]:checked')).map(c => c.value);\n}\n\nfunction getLocation() {\n  const countrySel = document.getElementById('countrySelect');\n  const citySel = document.getElementById('citySelect');\n  let base = { city: 'London', country: 'United Kingdom', country_code: 'GB' };\n\n  try {\n    if (countrySel && countrySel.value) {\n      const c = JSON.parse(countrySel.value);\n      base = {\n        city: '',\n        country: c.name || c.country || '',\n        country_code: c.code || c.country_code || ''\n      };\n    } else if (citySel && citySel.value) {\n      base = JSON.parse(citySel.value);\n    }\n  } catch (e) {\n    console.warn(\"getLocation() parse failed, using default:\", e);\n  }\n\n  // City override from free input\n  const cityOverride = cityInputFree?.value?.trim();\n  if (cityOverride) base.city = cityOverride;\n\n  const lat = parseFloat(latInput?.value ?? \"\");\n  const lng = parseFloat(lngInput?.value ?? \"\");\n  if (!Number.isNaN(lat) && !Number.isNaN(lng)) {\n    base.latitude = lat;\n    base.longitude = lng;\n  }\n  return base;\n}\n\n\n// ------------------ COUNTRY DROPDOWN ------------------\n// Safe country loader (only runs if #countrySelect exists)\nasync function loadCountriesIfPresent() {\n  const sel = document.getElementById('countrySelect');\n  if (!sel) return; // This page uses #citySelect instead. Skip.\n  try {\n    const res = await fetch(`${SERVER}/v1/countries`);\n    const data = await res.json();\n    if (!data?.countries?.length) return;\n    sel.innerHTML =\n      `<option value=\"\" disabled selected>Select your country</option>` +\n      data.countries.map(c => `<option value='${JSON.stringify(c)}'>${c.name}</option>`).join(\"\");\n  } catch (e) {\n    console.warn(\"Countries failed\", e);\n  }\n}\ndocument.addEventListener(\"DOMContentLoaded\", loadCountriesIfPresent);\n\n\ncountrySelect?.addEventListener(\"change\", () => {\n  try {\n    const selected = JSON.parse(countrySelect.value);\n    if (selectedFlag) {\n      // You already import countryCodeToEmoji from helpers\n      selectedFlag.textContent = countryCodeToEmoji(selected.code || selected.country_code);\n    }\n  } catch {}\n});\n\n// ------------------ QUICK MOODS ------------------\ndocument.getElementById('quickMoods')?.addEventListener('click', (e) => {\n  const btn = e.target.closest('.mood-chip');\n  if (!btn) return;\n  // visual active\n  document.querySelectorAll('.mood-chip').forEach(b => b.classList.remove('active'));\n  btn.classList.add('active');\n\n  const map = {\n    tired: 'tired and need something comforting',\n    stressed: 'stressed but want something light',\n    celebrating: 'celebrating a small win',\n    hungry: 'very hungry and need food fast'\n  };\n  const val = map[btn.dataset.quick] || btn.dataset.quick;\n  document.getElementById('moodInput').value = val;\n});\n\n// OPTIONAL demo mood detection\nif (detectMoodBtn) {\n  detectMoodBtn.addEventListener('click', () => {\n    if (!moodInput.value.trim()) {\n      moodInput.value = 'stressed but want something light';\n    }\n    detectMoodBtn.textContent = '🧠 Mood understood!';\n    setTimeout(() => (detectMoodBtn.textContent = '✨ Detect Mood (AI)'), 1200);\n  });\n}\n\n\n// ------------------ MAIN RECOMMEND CALL ------------------\ndecideBtn?.addEventListener('click', async () => {\n  const mood_text = (document.getElementById('moodInput')?.value || '').trim() || 'hungry';\n  const location  = getLocation();\n  const chipsWrap = document.getElementById('dietaryChips');\n  const dietary   = chipsWrap ? Array.from(chipsWrap.querySelectorAll('input[type=\"checkbox\"]:checked')).map(c => c.value) : [];\n  const budget    = document.getElementById('budgetSelect')?.value || 'medium';\n\n  lastPayload = { location, mood_text, dietary, budget, menu_source: 'global_database' };\n  LS.set('vfied:lastPayload', lastPayload);\n  setThinking(true);\n  try {\n    const res  = await fetch(`${SERVER}/v1/recommend`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(lastPayload)\n    });\n    const text = await res.text();\n    const data = JSON.parse(text);\n\n    if (!res.ok || !data?.success) throw new Error(data?.error || `HTTP ${res.status}`);\n\n    // show result\n    const set = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v; };\n\n    const food = data.food || {};\n    set('foodEmoji',  food.emoji || '🍽️');\n    set('foodName',   food.name  || 'Great Choice');\n    set('friendMessage', data.friendMessage || data.description || '');\n    set('reasoning',  data.reasoning || data.reason || '');\n    set('culturalNote', data.culturalNote || '');\n    set('dietaryNote', data.dietaryNote || '—');\n    set('weatherNote', data.weatherNote || data.weatherReasoning || '—');\n\n    // flag + confidence + weather\n    set('countryCode', food.country_code ? countryCodeToEmoji(food.country_code) : '—');\n    set('confidence', (typeof data.confidence === 'number') ? `Confidence: ${data.confidence}%` : 'Confidence: —');\n    set('weatherBadge',\n      (data?.weather?.description || (data?.weather && data.weather.temperature != null))\n        ? `Weather: ${data.weather.temperature ?? '—'}°C • ${data.weather.description ?? data.weather.condition ?? ''}`.trim()\n        : 'Weather: —'\n    );\n\n    // engine badge\n    const engineEl = document.getElementById('engineBadge');\n    if (engineEl) engineEl.textContent =\n      (data.source === 'gpt' || data.context?.mood_detection_method === 'ai') ? 'Engine: GPT' :\n      (data.source === 'uploaded_menu') ? 'Engine: Vendor Menu' : 'Engine: Fallback';\n\n    document.getElementById('resultCard').style.display = 'block';\n    \n    fetch(`${SERVER}/v1/telemetry`, {\n      method: 'POST', \n      headers: {'Content-Type':'application/json'},\n      body: JSON.stringify({ event: 'decide_success', payload: { location, dietary } })\n    }).catch(()=>{});\n  } catch (e) {\n    console.error(e);\n    alert(`Error: ${e.message}`);\n  } finally {\n    setThinking(false);\n  }\n});\n\n\n//------------------- EVENTS  ------------------\ndocument.getElementById('loadEventsBtn')?.addEventListener('click', async () => {\n  const grid = document.getElementById('eventsGrid');\n  if (!grid) return;\n  const loc = getLocation();\n  const url = `${SERVER}/v1/events?city=${encodeURIComponent(loc.city||'')}&country_code=${encodeURIComponent(loc.country_code||'')}`;\n  grid.innerHTML = '<div class=\"muted\">Loading events…</div>';\n  try {\n    const r = await fetch(url);\n    const data = await r.json();\n    const events = data?.events || [];\n    if (!events.length) {\n      grid.innerHTML = '<div class=\"muted\">No events found.</div>';\n      return;\n    }\n    grid.innerHTML = events.map(e => {\n      const pairing = (loc.country_code === 'KE') ? 'Try Nyama Choma nearby.' :\n                      (loc.country_code === 'GB') ? 'Pair with fish & chips.' :\n                      (loc.country_code === 'JP') ? 'Grab ramen after.' : 'Find a local favorite.';\n      const emoji = e.tag === 'music' ? '🎶' : e.tag === 'food' ? '🍢' : '🎬';\n      return `\n        <div class=\"event-card\">\n          <div class=\"event-badge\">${emoji}</div>\n          <div class=\"event-body\">\n            <div class=\"event-title\">${e.title}</div>\n            <div class=\"event-meta\">${e.when} — ${e.city} ${e.country_code}</div>\n            <div class=\"event-meta\">${pairing}</div>\n            <div class=\"event-cta\">\n              <a class=\"small secondary\" href=\"${SERVER}/v1/linkout?tag=event&url=${encodeURIComponent(`https://www.google.com/search?q=${encodeURIComponent(`${e.title} ${e.city}`)}`)}\" target=\"_blank\" rel=\"noopener\">Book (demo)</a>\n              <button class=\"small\" onclick=\"document.getElementById('decideBtn').scrollIntoView({behavior:'smooth'});\">Suggest food</button>\n            </div>\n          </div>\n        </div>`;\n    }).join('');\n    fetch(`${SERVER}/v1/telemetry`, {\n      method: 'POST', \n      headers: {'Content-Type':'application/json'},\n      body: JSON.stringify({ event: 'events_view', payload: { city: loc.city, code: loc.country_code } })\n    }).catch(()=>{});\n  } catch (e) {\n    grid.innerHTML = '<div class=\"muted\">Failed to load events.</div>';\n  }\n});\n//------------------- TRAVEL  ------------------\ndocument.getElementById('loadTravelBtn')?.addEventListener('click', async () => {\n  const grid  = document.getElementById('travelGrid');\n  const intro = document.getElementById('travelIntro');\n  if (!grid) return;\n\n  const loc = getLocation();\n  const url = `${SERVER}/v1/travel/highlights?city=${encodeURIComponent(loc.city||'')}&country_code=${encodeURIComponent(loc.country_code||'')}`;\n\n  grid.innerHTML = '<div class=\"muted\">Loading must-try…</div>';\n  intro.textContent = '';\n\n  try {\n    const r = await fetch(url);\n    const data = await r.json();\n    intro.textContent = data?.intro || '';\n\n    const dishes = data?.dishes || [];\n    if (!dishes.length) {\n      grid.innerHTML = '<div class=\"muted\">No highlights yet.</div>';\n      return;\n    }\n\n    grid.innerHTML = dishes.map(d => `\n      <div class=\"travel-card\">\n        <div class=\"travel-emoji\">${d.emoji || '🍽️'}</div>\n        <div class=\"travel-body\">\n          <div class=\"travel-title\">${d.name}</div>\n          <div class=\"travel-note\">${d.note || ''}</div>\n          <div class=\"travel-cta\">\n            <button class=\"small\" data-suggest='${encodeURIComponent(JSON.stringify(d))}'>Suggest this</button>\n            <button class=\"small\" onclick=\"window.open('${SERVER}/v1/linkout?tag=maps&url=${encodeURIComponent(`https://www.google.com/maps/search/${encodeURIComponent(`${d.name} ${loc.city||''}`)}`)}}','_blank','noopener')\">Open in Maps</button>\n          </div>\n        </div>\n      </div>\n    `).join('');\n\n  } catch (e) {\n    grid.innerHTML = '<div class=\"muted\">Failed to load highlights.</div>';\n  }\n});\n\n// Delegate clicks on \"Suggest this\" to trigger your existing Decide flow\ndocument.getElementById('tab-travel')?.addEventListener('click', async (e) => {\n  const btn = e.target.closest('button[data-suggest]');\n  if (!btn) return;\n  try {\n    const d = JSON.parse(decodeURIComponent(btn.dataset.suggest));\n    // Build a payload that biases the suggestion to this dish name\n    const loc = getLocation();\n    const mood_text = `I want to try ${d.name}`;\n    const payload = { location: loc, mood_text, dietary: [], budget: 'medium', menu_source: 'global_database' };\n\n    // Optional: smooth scroll to result\n    document.getElementById('decideBtn')?.scrollIntoView({ behavior:'smooth', block:'center' });\n\n    // Call your existing recommend endpoint\n    const res = await fetch(`${SERVER}/v1/recommend`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload)\n    });\n    const data = await res.json();\n    if (!res.ok || !data?.success) throw new Error(data?.error || `HTTP ${res.status}`);\n\n    // Render result card\n    document.getElementById('resultCard').style.display = 'block';\n    document.getElementById('foodEmoji').textContent = data.food?.emoji || (d.emoji || '🍽️');\n    document.getElementById('foodName').textContent  = data.food?.name  || d.name;\n    document.getElementById('friendMessage').textContent = data.friendMessage || `Great pick for ${loc.city || 'your trip'}!`;\n\n  } catch (err) {\n    alert('Could not suggest this item.');\n  }\n});\n\n// ------------------ ACCEPT / RETRY ------------------\ndocument.getElementById('acceptBtn').addEventListener('click', () => {\n  alert('✅ Saved! Enjoy your meal.');\n  resultCard.style.display = 'none';\n});\ndocument.getElementById('tryAgainBtn')?.addEventListener('click', async () => {\n  const btn = document.getElementById('tryAgainBtn');\n  btn.disabled = true;\n  setThinking(true);\n  try {\n    const payload = lastPayload || {\n      location: getLocation(),\n      mood_text: (moodInput?.value || 'hungry'),\n      dietary: getSelectedDietary ? getSelectedDietary() : [],\n      budget: budgetSelect?.value || 'medium',\n      menu_source: 'global_database'\n    };\n    const res  = await fetch(`${SERVER}/v1/recommend`, {\n      method: 'POST', headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload)\n    });\n    const data = await res.json();\n    if (!res.ok || !data?.success) throw new Error(data?.error || `HTTP ${res.status}`);\n\n    // minimal re-render\n    document.getElementById('resultCard').style.display = 'block';\n    document.getElementById('foodEmoji').textContent = data.food?.emoji || '🍽️';\n    document.getElementById('foodName').textContent  = data.food?.name  || 'Great Choice';\n    document.getElementById('friendMessage').textContent = data.friendMessage || '';\n  } catch (e) {\n    alert(`Error: ${e.message}`);\n  } finally {\n    setThinking(false);\n    btn.disabled = false;\n  }\n});\n\n// ------------------ VENDOR UPLOAD ------------------\nuploadMenuBtn.addEventListener('click', async () => {\n  try {\n    const menu = JSON.parse(menuTextarea.value);\n    const res = await fetch(`${SERVER}/v1/menus`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },\n      body: JSON.stringify({ mode: 'snapshot', menu })\n    });\n    const data = await res.json();\n\n    if (!res.ok) throw new Error(data.error || 'Upload failed');\n\n    const accepted = (data.summary?.accepted ?? 0);\n    const total    = (data.summary?.total ?? menu.length);\n    const names    = Array.isArray(menu) ? menu.map(m => m.name).filter(Boolean).join(', ') : '';\n\n    menuResponse.textContent =\n      `✅ Menu uploaded (accepted ${accepted}/${total})\\n`+\n      `version: ${data.menu_version}\\n`+\n      (names ? `items: ${names}\\n` : '') +\n      (data.errors?.length ? `errors: ${JSON.stringify(data.errors, null, 2)}` : '');\n\n    // Optional: preview a suggestion from uploaded menu\n    const recRes = await fetch(`${SERVER}/v1/recommend`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${API_KEY}` },\n      body: JSON.stringify({ menu_source: \"my_uploaded_menu\" })\n    });\n    const recData = await recRes.json();\n    menuResponse.textContent += `\\n\\nSuggestion → ${recData?.food?.name || 'n/a'} ${recData?.food?.emoji || ''}`;\n  } catch (e) {\n    menuResponse.textContent = `❌ ${e.message}`;\n  }\n});\n// ------------------ SERVICE WORKER ------------------\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js').catch(err => console.warn('SW reg failed', err));\n  });\n}\nviewMenuBtn.addEventListener('click', async () => {\n  try {\n    const res = await fetch(`${SERVER}/v1/menus`, {\n      headers: { 'Authorization': `Bearer ${API_KEY}` }\n    });\n    const data = await res.json();\n    menuResponse.textContent = JSON.stringify(data, null, 2);\n  } catch (e) {\n    menuResponse.textContent = `Error: ${e.message}`;\n  }\n});\n// Add at the very end of main.js:\nlet deferredPrompt=null;\nwindow.addEventListener('beforeinstallprompt', (e)=>{\n  e.preventDefault(); \n  deferredPrompt=e;\n  const b=document.getElementById('installBanner'); \n  if(b) b.style.display='block';\n});\ndocument.getElementById('installBtn')?.addEventListener('click', async ()=>{\n  if(!deferredPrompt) return;\n  deferredPrompt.prompt(); \n  await deferredPrompt.userChoice; \n  deferredPrompt=null;\n  document.getElementById('installBanner').style.display='none';\n});\ndocument.getElementById('installClose')?.addEventListener('click', ()=>{\n  document.getElementById('installBanner').style.display='none';\n});\n// ---- Events ----\nconst eventsGrid = document.getElementById('eventsGrid');\nconst loadEventsBtn = document.getElementById('loadEventsBtn');\n\nloadEventsBtn?.addEventListener('click', async () => {\n  const loc = getLocation();\n  eventsGrid.innerHTML = '<div class=\"muted\">Loading…</div>';\n  try {\n    const r = await fetch(`${SERVER}/v1/events?city=${encodeURIComponent(loc.city||'')}&country_code=${encodeURIComponent(loc.country_code||'')}`);\n    const data = await r.json();\n    const events = data?.events || [];\n    if (!events.length) { eventsGrid.innerHTML = '<div class=\"muted\">No events found.</div>'; return; }\n\n    eventsGrid.innerHTML = events.map(e => {\n      const emoji = e.tag === 'music' ? '🎶' : e.tag === 'food' ? '🍢' : '🎬';\n      const mood  = e.tag === 'music' ? 'celebrating' : e.tag === 'food' ? 'adventurous' : 'relax';\n      const realUrl = `https://www.google.com/search?q=${encodeURIComponent(`${e.title} ${e.city}`)}`;\n      const tracked = `${SERVER}/v1/linkout?tag=event&url=${encodeURIComponent(realUrl)}`;\n      return `\n        <div class=\"event-card\">\n          <div class=\"event-badge\">${emoji}</div>\n          <div class=\"event-body\">\n            <div class=\"event-title\">${e.title}</div>\n            <div class=\"event-meta\">${e.when} — ${e.city} ${e.country_code}</div>\n            <div class=\"row\" style=\"gap:8px; margin-top:6px\">\n              <button class=\"small\" data-suggest-mood=\"${mood}\">Suggest food for this</button>\n              <a class=\"small secondary\" href=\"${tracked}\" target=\"_blank\" rel=\"noopener\">Book (demo)</a>\n            </div>\n          </div>\n        </div>`;\n    }).join('');\n  } catch {\n    eventsGrid.innerHTML = '<div class=\"muted\">Failed to load events.</div>';\n  }\n});\n\n// Delegate: click \"Suggest food for this\"\neventsGrid?.addEventListener('click', async (ev) => {\n  const btn = ev.target.closest('button[data-suggest-mood]');\n  if (!btn) return;\n  const loc = getLocation();\n  const mood_text = `I'm ${btn.dataset.suggestMood} and want something local`;\n  setThinking(true);\n  try {\n    const res = await fetch(`${SERVER}/v1/recommend`, {\n      method:'POST', headers:{'Content-Type':'application/json'},\n      body: JSON.stringify({ location: loc, mood_text, dietary: getSelectedDietary(), budget: budgetSelect?.value || 'medium' })\n    });\n    const data = await res.json();\n    if (data?.success) {\n      resultCard.style.display = 'block';\n      foodEmoji.textContent = data.food?.emoji || '🍽️';\n      foodName.textContent  = data.food?.name  || 'Great Choice';\n      friendMessage.textContent = data.friendMessage || '';\n    }\n  } finally { setThinking(false); }\n});\n// ---- Travel ----\nconst travelGrid = document.getElementById('travelGrid');\nconst loadTravelBtn = document.getElementById('loadTravelBtn');\n\nloadTravelBtn?.addEventListener('click', async () => {\n  const loc = getLocation();\n  travelGrid.innerHTML = '<div class=\"muted\">Loading…</div>';\n  try {\n    const r = await fetch(`${SERVER}/v1/travel/highlights?city=${encodeURIComponent(loc.city||'')}&country_code=${encodeURIComponent(loc.country_code||'')}`);\n    const data = await r.json();\n    const items = data?.highlights || [];\n    if (!items.length) { travelGrid.innerHTML = '<div class=\"muted\">No highlights yet.</div>'; return; }\n\n    travelGrid.innerHTML = items.map(d => {\n      const maps = `https://www.google.com/maps/search/${encodeURIComponent(`${d.name} ${loc.city||''}`)}`;\n      const mapsTracked = `${SERVER}/v1/linkout?tag=maps&url=${encodeURIComponent(maps)}`;\n      return `\n        <div class=\"travel-card\">\n          <div class=\"travel-badge\">${d.emoji || '🗺️'}</div>\n          <div class=\"travel-body\">\n            <div class=\"travel-title\">${d.name}</div>\n            <div class=\"muted\">${d.desc || ''}</div>\n            <div class=\"row\" style=\"gap:8px; margin-top:6px\">\n              <button class=\"small\" data-suggest-food=\"${d.name}\">Suggest food near here</button>\n              <a class=\"small secondary\" href=\"${mapsTracked}\" target=\"_blank\" rel=\"noopener\">Open in Maps</a>\n            </div>\n          </div>\n        </div>`;\n    }).join('');\n  } catch {\n    travelGrid.innerHTML = '<div class=\"muted\">Failed to load highlights.</div>';\n  }\n});\n\nconst copyPlanBtn = document.getElementById('copyPlanBtn');\ncopyPlanBtn?.addEventListener('click', async () => {\n  try {\n    // Prefer the structured JSON (lastPlanData). Fall back to scraping the DOM if needed.\n    let text = '';\n    if (lastPlanData && (lastPlanData.timeline || lastPlanData.plan || lastPlanData.planTitle)) {\n      const city  = lastPlanData.city || '';\n      const title = lastPlanData.planTitle || `Local Night Plan${city ? ' — ' + city : ''}`;\n      const rows  = Array.isArray(lastPlanData.timeline) ? lastPlanData.timeline : [];\n      const tips  = Array.isArray(lastPlanData.tips) ? lastPlanData.tips : [];\n\n      const lines = [];\n      lines.push(title);\n      lines.push('');\n\n      rows.forEach(s => {\n        const t   = s.time ? `${s.time} ` : '';\n        const act = s.activity || s.title || '';\n        const emo = s.emoji ? `${s.emoji} ` : '';\n        lines.push(`${t}${emo}${act}`.trim());\n        if (s.food) lines.push(`  • Food: ${s.food}`);\n        if (s.note) lines.push(`  • ${s.note}`);\n        if (s.link) lines.push(`  • Link: ${s.link}`);\n        lines.push('');\n      });\n\n      if (tips.length) {\n        lines.push('Tips:');\n        tips.forEach(t => lines.push(`  • ${t}`));\n      }\n\n      text = lines.join('\\n');\n    } else {\n      // Fallback: copy whatever is visible in the plan box\n      const box = document.getElementById('planBox');\n      text = box ? box.innerText.trim() : 'Night plan';\n    }\n\n    // Write to clipboard (with fallback)\n    if (navigator.clipboard?.writeText) {\n      await navigator.clipboard.writeText(text);\n      toast('✅ Plan copied to clipboard');\n    } else {\n      // old-school fallback\n      const ta = document.createElement('textarea');\n      ta.value = text;\n      document.body.appendChild(ta);\n      ta.select();\n      document.execCommand('copy');\n      document.body.removeChild(ta);\n      toast('✅ Plan copied');\n    }\n  } catch (e) {\n    alert('Could not copy plan: ' + e.message);\n  }\n});\n\n// tiny toast helper (no deps)\nfunction toast(msg) {\n  const t = document.createElement('div');\n  t.textContent = msg;\n  t.style.position = 'fixed';\n  t.style.bottom = '16px';\n  t.style.left = '50%';\n  t.style.transform = 'translateX(-50%)';\n  t.style.background = '#0b1220';\n  t.style.border = '1px solid #263247';\n  t.style.padding = '10px 14px';\n  t.style.borderRadius = '10px';\n  t.style.color = '#e2e8f0';\n  t.style.fontSize = '14px';\n  t.style.zIndex = '9999';\n  t.style.boxShadow = '0 8px 24px rgba(0,0,0,.35)';\n  document.body.appendChild(t);\n  setTimeout(() => t.remove(), 1500);\n}\n\n// Delegate: \"Suggest food near here\"\ntravelGrid?.addEventListener('click', async (ev) => {\n  const btn = ev.target.closest('button[data-suggest-food]');\n  if (!btn) return;\n  const loc = getLocation();\n  const mood_text = `I want something near ${btn.dataset.suggestFood}, authentic and local.`;\n  setThinking(true);\n  try {\n    const res = await fetch(`${SERVER}/v1/recommend`, {\n      method:'POST', headers:{'Content-Type':'application/json'},\n      body: JSON.stringify({ location: loc, mood_text, dietary: getSelectedDietary(), budget: budgetSelect?.value || 'medium' })\n    });\n    const data = await res.json();\n    if (data?.success) {\n      resultCard.style.display = 'block';\n      foodEmoji.textContent = data.food?.emoji || '🍽️';\n      foodName.textContent  = data.food?.name  || 'Great Choice';\n      friendMessage.textContent = data.friendMessage || '';\n    }\n  } finally { setThinking(false); }\n});\n// ---- GPT Night Plan ----\nconst genPlanBtn = document.getElementById('genPlanBtn');\nconst planPrompt = document.getElementById('planPrompt');\nconst planBox    = document.getElementById('planBox');\n\ngenPlanBtn?.addEventListener('click', async () => {\n  const loc = getLocation();\n  const prompt = (planPrompt?.value?.trim()) || 'I want to try local experiences in the city tonight. Map a night plan with food and vibes.';\n  planBox.innerHTML = '<div class=\"muted\">Planning your night…</div>';\n  try {\n    const r = await fetch(`${SERVER}/v1/travel/plan`, {\n      method:'POST', headers:{'Content-Type':'application/json'},\n      body: JSON.stringify({ location: loc, prompt })\n    });\n    const data = await r.json();\n    lastPlanData = data;\n    if (!data?.success && !data?.timeline) throw new Error('No plan');\n\n    const timeline = (data.timeline || []).map(s => {\n      const url = s.link ? `${SERVER}/v1/linkout?tag=plan&url=${encodeURIComponent(s.link)}` : null;\n      return `\n        <div class=\"step\">\n          <span class=\"time\">${s.time || ''}</span>\n          <span class=\"act\">${s.emoji || ''} ${s.activity || ''}</span>\n          ${s.food ? `<div class=\"muted\">Food: ${s.food}</div>` : ''}\n          ${s.note ? `<div class=\"muted\">${s.note}</div>` : ''}\n          ${url ? `<div><a class=\"small\" href=\"${url}\" target=\"_blank\" rel=\"noopener\">Open link</a></div>` : ''}\n        </div>`;\n    }).join('');\n\n    planBox.innerHTML = `\n      <div class=\"big\" style=\"margin-bottom:6px\">${data.planTitle || 'Local Night Plan'}</div>\n      <div class=\"timeline\">${timeline}</div>\n      ${Array.isArray(data.tips) && data.tips.length ? `\n      <div style=\"margin-top:8px\">\n        <div class=\"event-title\">Tips</div>\n        <ul>${data.tips.map(t => `<li>${t}</li>`).join('')}</ul>\n      </div>` : '' }\n    `;\n  } catch (e) {\n    planBox.innerHTML = `<div class=\"muted\">Couldn't generate a plan: ${e.message}</div>`;\n  }\n});\n\n// Night Plan (demo endpoint)\nconst genNightPlanBtn = document.getElementById('genNightPlanBtn');\n\ngenNightPlanBtn?.addEventListener('click', async () => {\n  const loc = getLocation();\n  planBox.innerHTML = '<div class=\"muted\">Planning your night…</div>';\n  try {\n    const r = await fetch(`${SERVER}/v1/travel/nightplan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ location: loc })\n    });\n    const data = await r.json();\n    lastPlanData = data;\n    if (!data?.success && !data?.timeline) throw new Error('No plan generated');\n\n    // Render exactly like your example\n    const timelineHtml = (data.timeline || []).map((s, idx) => {\n      const tracked = s.link ? `${SERVER}/v1/linkout?tag=nightplan&url=${encodeURIComponent(s.link)}` : null;\n      // Encode the step as data-attrs for later use\n      const stepData = {\n        time: s.time || '',\n        activity: s.activity || '',\n        food: s.food || '',\n        emoji: s.emoji || '',\n        note: s.note || ''\n      };\n      const stepAttr = encodeURIComponent(JSON.stringify(stepData));\n      return `\n        <div class=\"step\">\n          <div class=\"big\">${s.time || ''} ${s.emoji || ''} ${s.activity || ''}</div>\n          ${s.food ? `<div>Food: <strong>${s.food}</strong></div>` : ''}\n          ${s.note ? `<div class=\"muted\">${s.note}</div>` : ''}\n          <div class=\"row\" style=\"gap:8px; margin-top:4px\">\n            <button class=\"small suggest-step-btn\" data-step='${stepAttr}'>Suggest food for this step</button>\n            ${tracked ? `<a class=\"small secondary\" href=\"${tracked}\" target=\"_blank\" rel=\"noopener\">Open link</a>` : ''}\n          </div>\n        </div>`;\n    }).join('');\n\n    planBox.innerHTML = `\n      <div class=\"big\">${data.planTitle || `Local Night Plan in ${data.city || ''}`}</div>\n      <div class=\"timeline\" style=\"margin-top:6px\">${timelineHtml}</div>\n      ${\n        Array.isArray(data.tips) && data.tips.length\n          ? `<div style=\"margin-top:10px\"><div class=\"event-title\">Tips</div><ul>${\n              data.tips.map(t => `<li>${t}</li>`).join('')\n            }</ul></div>`\n          : ''\n      }\n    `;\n  } catch (e) {\n    planBox.innerHTML = `<div class=\"muted\">Couldn't generate a plan: ${e.message}</div>`;\n  }\n});\n\n// Delegate: click \"Suggest food for this step\" in the Night Plan\nplanBox?.addEventListener('click', async (ev) => {\n  const btn = ev.target.closest('.suggest-step-btn');\n  if (!btn) return;\n\n  // Extract step data\n  let step = {};\n  try { step = JSON.parse(decodeURIComponent(btn.dataset.step || '%7B%7D')); } catch {}\n  const loc = getLocation();\n\n  // Infer mood from step (simple, effective heuristic)\n  const a = (step.activity || '').toLowerCase();\n  const f = (step.food || '').toLowerCase();\n  let mood_text = 'local, authentic, balanced';\n  if (/walk|market|stroll|crawl|night/i.test(a)) mood_text = 'adventurous street-food vibes';\n  if (/jazz|music|bar|pub|live/i.test(a))        mood_text = 'celebrating with light bites';\n  if (/dinner|signature|restaurant|hearty/i.test(a)) mood_text = 'comforting, authentic, hearty';\n  if (/dessert|sweet|ice cream|gelato/i.test(a)) mood_text = 'sweet finish, light and fun';\n  if (f) mood_text += `, inspired by ${step.food}`;\n\n  // Show a quick loading state on the button\n  const old = btn.textContent;\n  btn.disabled = true;\n  btn.textContent = 'Thinking…';\n\n  try {\n    const res = await fetch(`${SERVER}/v1/recommend`, {\n      method:'POST',\n      headers:{ 'Content-Type':'application/json' },\n      body: JSON.stringify({\n        location: loc,\n        mood_text,\n        dietary: (typeof getSelectedDietary === 'function') ? getSelectedDietary() : [],\n        budget: (budgetSelect?.value || 'medium'),\n        menu_source: 'global_database'\n      })\n    });\n    const data = await res.json();\n    if (!data?.success) throw new Error(data?.error || 'No suggestion');\n\n    // Render into your existing Result Card\n    if (resultCard) resultCard.style.display = 'block';\n    if (foodEmoji)  foodEmoji.textContent   = data.food?.emoji || '🍽️';\n    if (foodName)   foodName.textContent    = data.food?.name  || 'Great Choice';\n    if (friendMessage) friendMessage.textContent = data.friendMessage || `Because this step is \"${step.activity}\"`;\n\n    // KPIs and badges (safe if they exist)\n    const set = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v; };\n    set('dietaryNote', data.dietaryNote || '—');\n    set('weatherNote', data.weatherNote || data.weatherReasoning || '—');\n    set('countryCode', data.food?.country_code ? countryCodeToEmoji(data.food.country_code) : '—');\n    set('confidence', (typeof data.confidence === 'number') ? `Confidence: ${data.confidence}%` : 'Confidence: —');\n    set('weatherBadge',\n      (data?.weather?.description || (data?.weather && data.weather.temperature != null))\n        ? `Weather: ${data.weather.temperature ?? '—'}°C • ${data.weather.description ?? data.weather.condition ?? ''}`.trim()\n        : 'Weather: —'\n    );\n    const engineEl = document.getElementById('engineBadge');\n    if (engineEl) engineEl.textContent =\n      (data.source === 'gpt' || data.context?.mood_detection_method === 'ai') ? 'Engine: GPT' :\n      (data.source === 'uploaded_menu') ? 'Engine: Vendor Menu' : 'Engine: Fallback';\n\n  } catch (e) {\n    alert(`Couldn't suggest for this step: ${e.message}`);\n  } finally {\n    btn.disabled = false;\n    btn.textContent = old;\n  }\n});"],"names":["countryCodeToEmoji","cc","code","A","SERVER","API_KEY","moodInput","decideBtn","detectMoodBtn","countrySelect","citySelect","latInput","lngInput","budgetSelect","resultCard","foodEmoji","foodName","friendMessage","menuTextarea","uploadMenuBtn","viewMenuBtn","menuResponse","chipsWrap","selectedFlag","DIETARY","lastPlanData","LS","k","d","_a","e","v","cityInputFree","lastPayload","tabBtns","panels","btn","name","b","p","setThinking","on","activateTab","isActive","panel","last","mood","diet","budg","savedCity","el","sel","opt","renderChips","tag","id","chip","vals","x","val","getSelectedDietary","c","getLocation","countrySel","citySel","base","cityOverride","lat","_b","lng","_c","loadCountriesIfPresent","data","selected","mood_text","location","dietary","budget","res","text","set","food","_d","_f","_e","engineEl","_g","grid","loc","url","events","pairing","emoji","intro","dishes","payload","err","menu","accepted","total","names","m","recData","deferredPrompt","eventsGrid","loadEventsBtn","realUrl","tracked","ev","travelGrid","loadTravelBtn","items","maps","mapsTracked","copyPlanBtn","city","title","rows","tips","lines","t","act","emo","box","toast","ta","msg","genPlanBtn","planPrompt","planBox","prompt","timeline","s","genNightPlanBtn","timelineHtml","idx","stepData","stepAttr","step","a","f","old","_h"],"mappings":"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"}