function be(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();function ee(t){const e=(t||"").toUpperCase();if(e.length!==2)return"üè≥Ô∏è";const o=127462;return String.fromCodePoint(o+(e.charCodeAt(0)-65))+String.fromCodePoint(o+(e.charCodeAt(1)-65))}const u="http://localhost:3001",Z="demo_growth_key_456",w=document.getElementById("moodInput"),q=document.getElementById("decideBtn"),A=document.getElementById("detectMoodBtn"),R=document.getElementById("countrySelect"),G=document.getElementById("citySelect"),z=document.getElementById("latInput"),D=document.getElementById("lngInput"),g=document.getElementById("budgetSelect"),M=document.getElementById("resultCard"),J=document.getElementById("foodEmoji"),U=document.getElementById("foodName");document.getElementById("foodType");const F=document.getElementById("friendMessage");document.getElementById("reasoning");document.getElementById("culturalNote");document.getElementById("dietaryNote");document.getElementById("weatherNote");document.getElementById("countryCode");document.getElementById("confidence");document.getElementById("weatherBadge");const ge=document.getElementById("menuTextarea"),ve=document.getElementById("uploadMenuBtn"),pe=document.getElementById("viewMenuBtn"),_=document.getElementById("menuResponse"),k=document.getElementById("dietaryChips"),ne=document.getElementById("selectedFlag"),fe=["vegetarian","vegan","gluten-free","dairy-free","keto","halal","kosher","nut-free","paleo","pescatarian"];let f=null;const E={get(t,e=null){var o;try{return(o=JSON.parse(localStorage.getItem(t)))!=null?o:e}catch(c){return e}},set(t,e){localStorage.setItem(t,JSON.stringify(e))}},C=document.getElementById("cityInputFree");let H=null;const oe=document.querySelectorAll(".tab-btn"),he=document.querySelectorAll(".tab-panel");oe.forEach(t=>t.addEventListener("click",()=>{const e=t.dataset.tab;oe.forEach(o=>o.classList.toggle("active",o===t)),he.forEach(o=>o.style.display=o.id==="tab-".concat(e)?"block":"none")}));function I(t){const e=document.getElementById("decideBtn");e&&(e.disabled=!!t,e.textContent=t?"ü§ñ Thinking...":"üéØ Decide For Me",e.setAttribute("aria-busy",t?"true":"false"))}function ue(t){document.querySelectorAll(".tab").forEach(e=>{const o=e.dataset.tab===t;e.classList.toggle("active",o),e.setAttribute("aria-selected",o?"true":"false")}),document.querySelectorAll(".tabpanel").forEach(e=>{e.classList.toggle("hidden",e.id!=="tab-".concat(t))})}document.addEventListener("click",t=>{const e=t.target.closest(".tab");e&&ue(e.dataset.tab)});document.addEventListener("DOMContentLoaded",()=>{var a;ue("food");const t=E.get("vfied:lastPayload"),e=E.get("vfied:mood"),o=E.get("vfied:dietary",[]),c=E.get("vfied:budget"),n=E.get("vfied:city");n&&C&&(C.value=n),e&&(document.getElementById("moodInput").value=e),o!=null&&o.length&&o.forEach(i=>{const s=document.querySelector('#dietaryChips input[value="'.concat(i,'"]'));s&&(s.checked=!0)}),c&&(g.value=c);try{const i=(a=t==null?void 0:t.location)==null?void 0:a.country_code,s=document.getElementById("citySelect");if(i&&s){for(const m of s.options)if(JSON.parse(m.value).country_code===i){s.value=m.value;break}}}catch(i){}});function Ee(){k.innerHTML="",fe.forEach(t=>{const e="diet_".concat(t),o=document.createElement("label");o.className="chip",o.innerHTML='<input type="checkbox" id="'.concat(e,'" value="').concat(t,'"><span>').concat(t,"</span>"),k.appendChild(o)})}Ee();w==null||w.addEventListener("input",t=>E.set("vfied:mood",t.target.value));g==null||g.addEventListener("change",t=>E.set("vfied:budget",t.target.value));k==null||k.addEventListener("change",()=>{const t=Array.from(k.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value);E.set("vfied:dietary",t)});G==null||G.addEventListener("change",t=>{try{const e=JSON.parse(t.target.value);E.set("vfied:location",e)}catch(e){}});C==null||C.addEventListener("input",t=>E.set("vfied:city",t.target.value));function N(){return Array.from(k.querySelectorAll('input[type="checkbox"]:checked')).map(t=>t.value)}function h(){var i,s,m;const t=document.getElementById("countrySelect"),e=document.getElementById("citySelect");let o={city:"London",country:"United Kingdom",country_code:"GB"};try{if(t&&t.value){const l=JSON.parse(t.value);o={city:"",country:l.name||l.country||"",country_code:l.code||l.country_code||""}}else e&&e.value&&(o=JSON.parse(e.value))}catch(l){console.warn("getLocation() parse failed, using default:",l)}const c=(i=C==null?void 0:C.value)==null?void 0:i.trim();c&&(o.city=c);const n=parseFloat((s=z==null?void 0:z.value)!=null?s:""),a=parseFloat((m=D==null?void 0:D.value)!=null?m:"");return!Number.isNaN(n)&&!Number.isNaN(a)&&(o.latitude=n,o.longitude=a),o}async function $e(){var e;const t=document.getElementById("countrySelect");if(t)try{const c=await(await fetch("".concat(u,"/v1/countries"))).json();if(!((e=c==null?void 0:c.countries)!=null&&e.length))return;t.innerHTML='<option value="" disabled selected>Select your country</option>'+c.countries.map(n=>"<option value='".concat(JSON.stringify(n),"'>").concat(n.name,"</option>")).join("")}catch(o){console.warn("Countries failed",o)}}document.addEventListener("DOMContentLoaded",$e);R==null||R.addEventListener("change",()=>{try{const t=JSON.parse(R.value);ne&&(ne.textContent=ee(t.code||t.country_code))}catch(t){}});var se;(se=document.getElementById("quickMoods"))==null||se.addEventListener("click",t=>{const e=t.target.closest(".mood-chip");if(!e)return;document.querySelectorAll(".mood-chip").forEach(n=>n.classList.remove("active")),e.classList.add("active");const c={tired:"tired and need something comforting",stressed:"stressed but want something light",celebrating:"celebrating a small win",hungry:"very hungry and need food fast"}[e.dataset.quick]||e.dataset.quick;document.getElementById("moodInput").value=c});A&&A.addEventListener("click",()=>{w.value.trim()||(w.value="stressed but want something light"),A.textContent="üß† Mood understood!",setTimeout(()=>A.textContent="‚ú® Detect Mood (AI)",1200)});q==null||q.addEventListener("click",async()=>{var a,i,s,m,l,y,B;const t=(((a=document.getElementById("moodInput"))==null?void 0:a.value)||"").trim()||"hungry",e=h(),o=document.getElementById("dietaryChips"),c=o?Array.from(o.querySelectorAll('input[type="checkbox"]:checked')).map(p=>p.value):[],n=((i=document.getElementById("budgetSelect"))==null?void 0:i.value)||"medium";H={location:e,mood_text:t,dietary:c,budget:n,menu_source:"global_database"},E.set("vfied:lastPayload",H),I(!0);try{const p=await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)}),S=await p.text(),d=JSON.parse(S);if(!p.ok||!(d!=null&&d.success))throw new Error((d==null?void 0:d.error)||"HTTP ".concat(p.status));const v=(x,O)=>{const P=document.getElementById(x);P&&(P.textContent=O)},b=d.food||{};v("foodEmoji",b.emoji||"üçΩÔ∏è"),v("foodName",b.name||"Great Choice"),v("friendMessage",d.friendMessage||d.description||""),v("reasoning",d.reasoning||d.reason||""),v("culturalNote",d.culturalNote||""),v("dietaryNote",d.dietaryNote||"‚Äî"),v("weatherNote",d.weatherNote||d.weatherReasoning||"‚Äî"),v("countryCode",b.country_code?ee(b.country_code):"‚Äî"),v("confidence",typeof d.confidence=="number"?"Confidence: ".concat(d.confidence,"%"):"Confidence: ‚Äî"),v("weatherBadge",(s=d==null?void 0:d.weather)!=null&&s.description||d!=null&&d.weather&&d.weather.temperature!=null?"Weather: ".concat((m=d.weather.temperature)!=null?m:"‚Äî","¬∞C ‚Ä¢ ").concat((y=(l=d.weather.description)!=null?l:d.weather.condition)!=null?y:"").trim():"Weather: ‚Äî");const r=document.getElementById("engineBadge");r&&(r.textContent=d.source==="gpt"||((B=d.context)==null?void 0:B.mood_detection_method)==="ai"?"Engine: GPT":d.source==="uploaded_menu"?"Engine: Vendor Menu":"Engine: Fallback"),document.getElementById("resultCard").style.display="block",fetch("".concat(u,"/v1/telemetry"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"decide_success",payload:{location:e,dietary:c}})}).catch(()=>{})}catch(p){console.error(p),alert("Error: ".concat(p.message))}finally{I(!1)}});var ae;(ae=document.getElementById("loadEventsBtn"))==null||ae.addEventListener("click",async()=>{const t=document.getElementById("eventsGrid");if(!t)return;const e=h(),o="".concat(u,"/v1/events?city=").concat(encodeURIComponent(e.city||""),"&country_code=").concat(encodeURIComponent(e.country_code||""));t.innerHTML='<div class="muted">Loading events‚Ä¶</div>';try{const n=await(await fetch(o)).json(),a=(n==null?void 0:n.events)||[];if(!a.length){t.innerHTML='<div class="muted">No events found.</div>';return}t.innerHTML=a.map(i=>{const s=e.country_code==="KE"?"Try Nyama Choma nearby.":e.country_code==="GB"?"Pair with fish & chips.":e.country_code==="JP"?"Grab ramen after.":"Find a local favorite.",m=i.tag==="music"?"üé∂":i.tag==="food"?"üç¢":"üé¨";return'\n        <div class="event-card">\n          <div class="event-badge">'.concat(m,'</div>\n          <div class="event-body">\n            <div class="event-title">').concat(i.title,'</div>\n            <div class="event-meta">').concat(i.when," ‚Äî ").concat(i.city," ").concat(i.country_code,'</div>\n            <div class="event-meta">').concat(s,'</div>\n            <div class="event-cta">\n              <a class="small secondary" href="').concat(u,"/v1/linkout?tag=event&url=").concat(encodeURIComponent("https://www.google.com/search?q=".concat(encodeURIComponent("".concat(i.title," ").concat(i.city)))),'" target="_blank" rel="noopener">Book (demo)</a>\n              <button class="small" onclick="document.getElementById(\'decideBtn\').scrollIntoView({behavior:\'smooth\'});">Suggest food</button>\n            </div>\n          </div>\n        </div>')}).join(""),fetch("".concat(u,"/v1/telemetry"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"events_view",payload:{city:e.city,code:e.country_code}})}).catch(()=>{})}catch(c){t.innerHTML='<div class="muted">Failed to load events.</div>'}});var ce;(ce=document.getElementById("loadTravelBtn"))==null||ce.addEventListener("click",async()=>{const t=document.getElementById("travelGrid"),e=document.getElementById("travelIntro");if(!t)return;const o=h(),c="".concat(u,"/v1/travel/highlights?city=").concat(encodeURIComponent(o.city||""),"&country_code=").concat(encodeURIComponent(o.country_code||""));t.innerHTML='<div class="muted">Loading must-try‚Ä¶</div>',e.textContent="";try{const a=await(await fetch(c)).json();e.textContent=(a==null?void 0:a.intro)||"";const i=(a==null?void 0:a.dishes)||[];if(!i.length){t.innerHTML='<div class="muted">No highlights yet.</div>';return}t.innerHTML=i.map(s=>'\n      <div class="travel-card">\n        <div class="travel-emoji">'.concat(s.emoji||"üçΩÔ∏è",'</div>\n        <div class="travel-body">\n          <div class="travel-title">').concat(s.name,'</div>\n          <div class="travel-note">').concat(s.note||"",'</div>\n          <div class="travel-cta">\n            <button class="small" data-suggest=\'').concat(encodeURIComponent(JSON.stringify(s)),'\'>Suggest this</button>\n            <button class="small" onclick="window.open(\'').concat(u,"/v1/linkout?tag=maps&url=").concat(encodeURIComponent("https://www.google.com/maps/search/".concat(encodeURIComponent("".concat(s.name," ").concat(o.city||"")))),"}','_blank','noopener')\">Open in Maps</button>\n          </div>\n        </div>\n      </div>\n    ")).join("")}catch(n){t.innerHTML='<div class="muted">Failed to load highlights.</div>'}});var de;(de=document.getElementById("tab-travel"))==null||de.addEventListener("click",async t=>{var o,c,n;const e=t.target.closest("button[data-suggest]");if(e)try{const a=JSON.parse(decodeURIComponent(e.dataset.suggest)),i=h(),s="I want to try ".concat(a.name),m={location:i,mood_text:s,dietary:[],budget:"medium",menu_source:"global_database"};(o=document.getElementById("decideBtn"))==null||o.scrollIntoView({behavior:"smooth",block:"center"});const l=await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),y=await l.json();if(!l.ok||!(y!=null&&y.success))throw new Error((y==null?void 0:y.error)||"HTTP ".concat(l.status));document.getElementById("resultCard").style.display="block",document.getElementById("foodEmoji").textContent=((c=y.food)==null?void 0:c.emoji)||a.emoji||"üçΩÔ∏è",document.getElementById("foodName").textContent=((n=y.food)==null?void 0:n.name)||a.name,document.getElementById("friendMessage").textContent=y.friendMessage||"Great pick for ".concat(i.city||"your trip","!")}catch(a){alert("Could not suggest this item.")}});document.getElementById("acceptBtn").addEventListener("click",()=>{alert("‚úÖ Saved! Enjoy your meal."),M.style.display="none"});var re;(re=document.getElementById("tryAgainBtn"))==null||re.addEventListener("click",async()=>{var e,o;const t=document.getElementById("tryAgainBtn");t.disabled=!0,I(!0);try{const c=H||{location:h(),mood_text:(w==null?void 0:w.value)||"hungry",dietary:N?N():[],budget:(g==null?void 0:g.value)||"medium",menu_source:"global_database"},n=await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),a=await n.json();if(!n.ok||!(a!=null&&a.success))throw new Error((a==null?void 0:a.error)||"HTTP ".concat(n.status));document.getElementById("resultCard").style.display="block",document.getElementById("foodEmoji").textContent=((e=a.food)==null?void 0:e.emoji)||"üçΩÔ∏è",document.getElementById("foodName").textContent=((o=a.food)==null?void 0:o.name)||"Great Choice",document.getElementById("friendMessage").textContent=a.friendMessage||""}catch(c){alert("Error: ".concat(c.message))}finally{I(!1),t.disabled=!1}});ve.addEventListener("click",async()=>{var t,e,o,c,n,a,i;try{const s=JSON.parse(ge.value),m=await fetch("".concat(u,"/v1/menus"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Z)},body:JSON.stringify({mode:"snapshot",menu:s})}),l=await m.json();if(!m.ok)throw new Error(l.error||"Upload failed");const y=(e=(t=l.summary)==null?void 0:t.accepted)!=null?e:0,B=(c=(o=l.summary)==null?void 0:o.total)!=null?c:s.length,p=Array.isArray(s)?s.map(v=>v.name).filter(Boolean).join(", "):"";_.textContent="‚úÖ Menu uploaded (accepted ".concat(y,"/").concat(B,")\nversion: ").concat(l.menu_version,"\n")+(p?"items: ".concat(p,"\n"):"")+((n=l.errors)!=null&&n.length?"errors: ".concat(JSON.stringify(l.errors,null,2)):"");const d=await(await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Z)},body:JSON.stringify({menu_source:"my_uploaded_menu"})})).json();_.textContent+="\n\nSuggestion ‚Üí ".concat(((a=d==null?void 0:d.food)==null?void 0:a.name)||"n/a"," ").concat(((i=d==null?void 0:d.food)==null?void 0:i.emoji)||"")}catch(s){_.textContent="‚ùå ".concat(s.message)}});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(t=>console.warn("SW reg failed",t))});pe.addEventListener("click",async()=>{try{const e=await(await fetch("".concat(u,"/v1/menus"),{headers:{Authorization:"Bearer ".concat(Z)}})).json();_.textContent=JSON.stringify(e,null,2)}catch(t){_.textContent="Error: ".concat(t.message)}});let j=null;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),j=t;const e=document.getElementById("installBanner");e&&(e.style.display="block")});var le;(le=document.getElementById("installBtn"))==null||le.addEventListener("click",async()=>{j&&(j.prompt(),await j.userChoice,j=null,document.getElementById("installBanner").style.display="none")});var me;(me=document.getElementById("installClose"))==null||me.addEventListener("click",()=>{document.getElementById("installBanner").style.display="none"});const L=document.getElementById("eventsGrid"),W=document.getElementById("loadEventsBtn");W==null||W.addEventListener("click",async()=>{const t=h();L.innerHTML='<div class="muted">Loading‚Ä¶</div>';try{const o=await(await fetch("".concat(u,"/v1/events?city=").concat(encodeURIComponent(t.city||""),"&country_code=").concat(encodeURIComponent(t.country_code||"")))).json(),c=(o==null?void 0:o.events)||[];if(!c.length){L.innerHTML='<div class="muted">No events found.</div>';return}L.innerHTML=c.map(n=>{const a=n.tag==="music"?"üé∂":n.tag==="food"?"üç¢":"üé¨",i=n.tag==="music"?"celebrating":n.tag==="food"?"adventurous":"relax",s="https://www.google.com/search?q=".concat(encodeURIComponent("".concat(n.title," ").concat(n.city))),m="".concat(u,"/v1/linkout?tag=event&url=").concat(encodeURIComponent(s));return'\n        <div class="event-card">\n          <div class="event-badge">'.concat(a,'</div>\n          <div class="event-body">\n            <div class="event-title">').concat(n.title,'</div>\n            <div class="event-meta">').concat(n.when," ‚Äî ").concat(n.city," ").concat(n.country_code,'</div>\n            <div class="row" style="gap:8px; margin-top:6px">\n              <button class="small" data-suggest-mood="').concat(i,'">Suggest food for this</button>\n              <a class="small secondary" href="').concat(m,'" target="_blank" rel="noopener">Book (demo)</a>\n            </div>\n          </div>\n        </div>')}).join("")}catch(e){L.innerHTML='<div class="muted">Failed to load events.</div>'}});L==null||L.addEventListener("click",async t=>{var n,a;const e=t.target.closest("button[data-suggest-mood]");if(!e)return;const o=h(),c="I'm ".concat(e.dataset.suggestMood," and want something local");I(!0);try{const s=await(await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:o,mood_text:c,dietary:N(),budget:(g==null?void 0:g.value)||"medium"})})).json();s!=null&&s.success&&(M.style.display="block",J.textContent=((n=s.food)==null?void 0:n.emoji)||"üçΩÔ∏è",U.textContent=((a=s.food)==null?void 0:a.name)||"Great Choice",F.textContent=s.friendMessage||"")}finally{I(!1)}});const T=document.getElementById("travelGrid"),V=document.getElementById("loadTravelBtn");V==null||V.addEventListener("click",async()=>{const t=h();T.innerHTML='<div class="muted">Loading‚Ä¶</div>';try{const o=await(await fetch("".concat(u,"/v1/travel/highlights?city=").concat(encodeURIComponent(t.city||""),"&country_code=").concat(encodeURIComponent(t.country_code||"")))).json(),c=(o==null?void 0:o.highlights)||[];if(!c.length){T.innerHTML='<div class="muted">No highlights yet.</div>';return}T.innerHTML=c.map(n=>{const a="https://www.google.com/maps/search/".concat(encodeURIComponent("".concat(n.name," ").concat(t.city||""))),i="".concat(u,"/v1/linkout?tag=maps&url=").concat(encodeURIComponent(a));return'\n        <div class="travel-card">\n          <div class="travel-badge">'.concat(n.emoji||"üó∫Ô∏è",'</div>\n          <div class="travel-body">\n            <div class="travel-title">').concat(n.name,'</div>\n            <div class="muted">').concat(n.desc||"",'</div>\n            <div class="row" style="gap:8px; margin-top:6px">\n              <button class="small" data-suggest-food="').concat(n.name,'">Suggest food near here</button>\n              <a class="small secondary" href="').concat(i,'" target="_blank" rel="noopener">Open in Maps</a>\n            </div>\n          </div>\n        </div>')}).join("")}catch(e){T.innerHTML='<div class="muted">Failed to load highlights.</div>'}});const K=document.getElementById("copyPlanBtn");K==null||K.addEventListener("click",async()=>{var t;try{let e="";if(f&&(f.timeline||f.plan||f.planTitle)){const o=f.city||"",c=f.planTitle||"Local Night Plan".concat(o?" ‚Äî "+o:""),n=Array.isArray(f.timeline)?f.timeline:[],a=Array.isArray(f.tips)?f.tips:[],i=[];i.push(c),i.push(""),n.forEach(s=>{const m=s.time?"".concat(s.time," "):"",l=s.activity||s.title||"",y=s.emoji?"".concat(s.emoji," "):"";i.push("".concat(m).concat(y).concat(l).trim()),s.food&&i.push("  ‚Ä¢ Food: ".concat(s.food)),s.note&&i.push("  ‚Ä¢ ".concat(s.note)),s.link&&i.push("  ‚Ä¢ Link: ".concat(s.link)),i.push("")}),a.length&&(i.push("Tips:"),a.forEach(s=>i.push("  ‚Ä¢ ".concat(s)))),e=i.join("\n")}else{const o=document.getElementById("planBox");e=o?o.innerText.trim():"Night plan"}if((t=navigator.clipboard)!=null&&t.writeText)await navigator.clipboard.writeText(e),ie("‚úÖ Plan copied to clipboard");else{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),ie("‚úÖ Plan copied")}}catch(e){alert("Could not copy plan: "+e.message)}});function ie(t){const e=document.createElement("div");e.textContent=t,e.style.position="fixed",e.style.bottom="16px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.background="#0b1220",e.style.border="1px solid #263247",e.style.padding="10px 14px",e.style.borderRadius="10px",e.style.color="#e2e8f0",e.style.fontSize="14px",e.style.zIndex="9999",e.style.boxShadow="0 8px 24px rgba(0,0,0,.35)",document.body.appendChild(e),setTimeout(()=>e.remove(),1500)}T==null||T.addEventListener("click",async t=>{var n,a;const e=t.target.closest("button[data-suggest-food]");if(!e)return;const o=h(),c="I want something near ".concat(e.dataset.suggestFood,", authentic and local.");I(!0);try{const s=await(await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:o,mood_text:c,dietary:N(),budget:(g==null?void 0:g.value)||"medium"})})).json();s!=null&&s.success&&(M.style.display="block",J.textContent=((n=s.food)==null?void 0:n.emoji)||"üçΩÔ∏è",U.textContent=((a=s.food)==null?void 0:a.name)||"Great Choice",F.textContent=s.friendMessage||"")}finally{I(!1)}});const Y=document.getElementById("genPlanBtn"),X=document.getElementById("planPrompt"),$=document.getElementById("planBox");Y==null||Y.addEventListener("click",async()=>{var o;const t=h(),e=((o=X==null?void 0:X.value)==null?void 0:o.trim())||"I want to try local experiences in the city tonight. Map a night plan with food and vibes.";$.innerHTML='<div class="muted">Planning your night‚Ä¶</div>';try{const n=await(await fetch("".concat(u,"/v1/travel/plan"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:t,prompt:e})})).json();if(f=n,!(n!=null&&n.success)&&!(n!=null&&n.timeline))throw new Error("No plan");const a=(n.timeline||[]).map(i=>{const s=i.link?"".concat(u,"/v1/linkout?tag=plan&url=").concat(encodeURIComponent(i.link)):null;return'\n        <div class="step">\n          <span class="time">'.concat(i.time||"",'</span>\n          <span class="act">').concat(i.emoji||""," ").concat(i.activity||"","</span>\n          ").concat(i.food?'<div class="muted">Food: '.concat(i.food,"</div>"):"","\n          ").concat(i.note?'<div class="muted">'.concat(i.note,"</div>"):"","\n          ").concat(s?'<div><a class="small" href="'.concat(s,'" target="_blank" rel="noopener">Open link</a></div>'):"","\n        </div>")}).join("");$.innerHTML='\n      <div class="big" style="margin-bottom:6px">'.concat(n.planTitle||"Local Night Plan",'</div>\n      <div class="timeline">').concat(a,"</div>\n      ").concat(Array.isArray(n.tips)&&n.tips.length?'\n      <div style="margin-top:8px">\n        <div class="event-title">Tips</div>\n        <ul>'.concat(n.tips.map(i=>"<li>".concat(i,"</li>")).join(""),"</ul>\n      </div>"):"","\n    ")}catch(c){$.innerHTML='<div class="muted">Couldn\'t generate a plan: '.concat(c.message,"</div>")}});const Q=document.getElementById("genNightPlanBtn");Q==null||Q.addEventListener("click",async()=>{const t=h();$.innerHTML='<div class="muted">Planning your night‚Ä¶</div>';try{const o=await(await fetch("".concat(u,"/v1/travel/nightplan"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:t})})).json();if(f=o,!(o!=null&&o.success)&&!(o!=null&&o.timeline))throw new Error("No plan generated");const c=(o.timeline||[]).map((n,a)=>{const i=n.link?"".concat(u,"/v1/linkout?tag=nightplan&url=").concat(encodeURIComponent(n.link)):null,s={time:n.time||"",activity:n.activity||"",food:n.food||"",emoji:n.emoji||"",note:n.note||""},m=encodeURIComponent(JSON.stringify(s));return'\n        <div class="step">\n          <div class="big">'.concat(n.time||""," ").concat(n.emoji||""," ").concat(n.activity||"","</div>\n          ").concat(n.food?"<div>Food: <strong>".concat(n.food,"</strong></div>"):"","\n          ").concat(n.note?'<div class="muted">'.concat(n.note,"</div>"):"",'\n          <div class="row" style="gap:8px; margin-top:4px">\n            <button class="small suggest-step-btn" data-step=\'').concat(m,"'>Suggest food for this step</button>\n            ").concat(i?'<a class="small secondary" href="'.concat(i,'" target="_blank" rel="noopener">Open link</a>'):"","\n          </div>\n        </div>")}).join("");$.innerHTML='\n      <div class="big">'.concat(o.planTitle||"Local Night Plan in ".concat(o.city||""),'</div>\n      <div class="timeline" style="margin-top:6px">').concat(c,"</div>\n      ").concat(Array.isArray(o.tips)&&o.tips.length?'<div style="margin-top:10px"><div class="event-title">Tips</div><ul>'.concat(o.tips.map(n=>"<li>".concat(n,"</li>")).join(""),"</ul></div>"):"","\n    ")}catch(e){$.innerHTML='<div class="muted">Couldn\'t generate a plan: '.concat(e.message,"</div>")}});$==null||$.addEventListener("click",async t=>{var m,l,y,B,p,S,d,v;const e=t.target.closest(".suggest-step-btn");if(!e)return;let o={};try{o=JSON.parse(decodeURIComponent(e.dataset.step||"%7B%7D"))}catch(b){}const c=h(),n=(o.activity||"").toLowerCase(),a=(o.food||"").toLowerCase();let i="local, authentic, balanced";/walk|market|stroll|crawl|night/i.test(n)&&(i="adventurous street-food vibes"),/jazz|music|bar|pub|live/i.test(n)&&(i="celebrating with light bites"),/dinner|signature|restaurant|hearty/i.test(n)&&(i="comforting, authentic, hearty"),/dessert|sweet|ice cream|gelato/i.test(n)&&(i="sweet finish, light and fun"),a&&(i+=", inspired by ".concat(o.food));const s=e.textContent;e.disabled=!0,e.textContent="Thinking‚Ä¶";try{const r=await(await fetch("".concat(u,"/v1/recommend"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:c,mood_text:i,dietary:typeof N=="function"?N():[],budget:(g==null?void 0:g.value)||"medium",menu_source:"global_database"})})).json();if(!(r!=null&&r.success))throw new Error((r==null?void 0:r.error)||"No suggestion");M&&(M.style.display="block"),J&&(J.textContent=((m=r.food)==null?void 0:m.emoji)||"üçΩÔ∏è"),U&&(U.textContent=((l=r.food)==null?void 0:l.name)||"Great Choice"),F&&(F.textContent=r.friendMessage||'Because this step is "'.concat(o.activity,'"'));const x=(P,ye)=>{const te=document.getElementById(P);te&&(te.textContent=ye)};x("dietaryNote",r.dietaryNote||"‚Äî"),x("weatherNote",r.weatherNote||r.weatherReasoning||"‚Äî"),x("countryCode",(y=r.food)!=null&&y.country_code?ee(r.food.country_code):"‚Äî"),x("confidence",typeof r.confidence=="number"?"Confidence: ".concat(r.confidence,"%"):"Confidence: ‚Äî"),x("weatherBadge",(B=r==null?void 0:r.weather)!=null&&B.description||r!=null&&r.weather&&r.weather.temperature!=null?"Weather: ".concat((p=r.weather.temperature)!=null?p:"‚Äî","¬∞C ‚Ä¢ ").concat((d=(S=r.weather.description)!=null?S:r.weather.condition)!=null?d:"").trim():"Weather: ‚Äî");const O=document.getElementById("engineBadge");O&&(O.textContent=r.source==="gpt"||((v=r.context)==null?void 0:v.mood_detection_method)==="ai"?"Engine: GPT":r.source==="uploaded_menu"?"Engine: Vendor Menu":"Engine: Fallback")}catch(b){alert("Couldn't suggest for this step: ".concat(b.message))}finally{e.disabled=!1,e.textContent=s}});export{be as __vite_legacy_guard};
//# sourceMappingURL=index-Dby_a9Uv.js.map
