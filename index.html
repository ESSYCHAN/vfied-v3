<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  <title>VFIED – One Button Food Intelligence</title>

  <!-- PWA + theme -->
  <meta name="theme-color" content="#0b0f1a" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <!-- Styles (cache-busted) -->
  <link rel="stylesheet" href="/src/style.css?v=launch2">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="simple-header">
      <h1 class="app-title">VFIED 🍽️</h1>
      <p id="context-info" class="context-info">🤖 Initializing your food intelligence...</p>
    </header>

    <!-- One-Button Section -->
    <main class="one-button-main">
      <!-- Mood -->
      <section class="mood-section">
        <h3>🧠 Mood-aware suggestions</h3>
        <div class="mood-input-container">
          <input id="mood-input" class="mood-input"
            placeholder="How are you feeling? (e.g., stressed but want something light)" />
          <button id="detect-mood-btn" class="mood-detect-btn">Detect Mood</button>
        </div>
        <div id="detected-moods" class="detected-moods hidden"></div>
      </section>

      <!-- Social proof -->
      <section id="social-proof" style="max-width: 500px;margin: 1rem auto 0;">
        <h3 style="margin: 1rem 0 .5rem;">👥 Ask Your Friends</h3>
        <div id="friend-chips" class="friend-chips"></div>
      </section>

      <!-- Decide -->
      <section class="decision-area">
        <button id="decide-button" class="giant-decide-button">
          <span id="button-icon" class="button-icon">🎯</span>
          <span id="button-text" class="button-text">DECIDE FOR ME</span>
          <div class="button-subtitle">I'll figure it out for you</div>
        </button>
      </section>

      <!-- Loading skeleton -->
      <section id="suggestion-skeleton" class="suggestion-result hidden">
        <div class="suggestion-card skeleton suggestion-skeleton">
          <div class="skel-emoji"></div>
          <div class="skel-line" style="width: 65%; margin: 10px auto;"></div>
          <div class="skel-line" style="width: 85%; margin: 10px auto;"></div>
          <div class="skel-line" style="width: 55%; margin: 10px auto;"></div>
        </div>
      </section>

      <!-- Suggestion (aria-live for accessibility) -->
      <section id="suggestion-result" class="suggestion-result hidden" aria-live="polite">
        <div class="suggestion-card" id="resultCard">
          <div id="social-signals" class="social-signals"></div>

          <div id="mood-context" class="mood-context hidden">
            <div id="mood-match-text" class="mood-match"></div>
          </div>

          <div id="result-emoji" class="food-emoji">🍔</div>
          <h2 id="result-name" class="food-name">Your food suggestion</h2>
          <p id="result-description" class="food-description"></p>
          <div id="restaurant-info" class="restaurant-info"></div>
        </div>

        <div class="decision-actions">
          <button id="accept-btn" class="action-btn accept">✅ Accept</button>
          <button id="try-again-btn" class="action-btn try-again">🔄 Try Again</button>
        </div>

        <div class="ai-insights">
          <button id="insights-toggle" class="insights-toggle">🤖 Why this choice? ↓</button>
          <div id="insights-content" class="insights-content hidden">
            <div id="cultural-note" class="cultural-note"></div>
            <div id="personal-note" class="personal-note"></div>
            <div id="weather-note" class="weather-note"></div>
          </div>
        </div>
      </section>

      <!-- Local Gems -->
      <section style="max-width: 900px;margin: 1.5rem auto 0;padding: 0 12px;">
        <h3 style="margin-bottom:.5rem;">🌍 Local Gems</h3>
        <div id="local-gems-grid" class="local-gems-grid"></div>
        <div style="text-align:center;margin-top:10px;">
          <button id="see-more-gems" class="insights-toggle" style="display:inline-block;max-width:240px;">See more gems</button>
        </div>
      </section>

      <!-- Tabs -->
      <div class="tabs" style="max-width: 900px;margin: 1.5rem auto 0;padding: 0 12px;">
        <button class="tab tab-btn active" data-tab="tabTravel">✈️ Travel</button>
        <button class="tab tab-btn" data-tab="tabEvents">🎪 Events</button>
      </div>

      <!-- Travel tab -->
      <section id="tabTravel" class="tabpanel" style="max-width: 900px;margin: 0 auto;padding: 0 12px;">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap;">
          <label for="travel-city-select">City:</label>
          <select id="travel-city-select" class="setting-input" style="max-width:240px;">
            <!-- populated by JS -->
          </select>
        </div>
        <div id="travel-grid" class="travel-grid"></div>
      </section>

      <!-- Events tab -->
      <section id="tabEvents" class="tabpanel hidden" style="max-width: 900px;margin: 0 auto;padding: 0 12px;">
        <div id="events-grid" class="events-grid"></div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="simple-footer">
      <div class="stats-line">Decisions made: <span id="decisions-count">0</span> • Time saved: <span id="time-saved">0</span> min</div>
      <div id="ai-status" class="ai-status">🎯 Ready</div>
      <div class="bottom-safe-area"></div>
    </footer>
  </div>

  <!-- Local Gems Modal -->
  <div id="gems-modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button id="gems-modal-close" class="modal-close">×</button>
      <h3>🌍 Local Gems</h3>
      <ul id="gems-modal-list" class="modal-list"></ul>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toast-wrap" class="toast-wrap"></div>

  <!-- API base (HTTPS in prod). Comment the local line when deploying. -->
  <script>
    // For local dev:
    // window.__API__ = 'http://localhost:3001';

    // For production:
    window.__API__ = 'https://vfied-v3.onrender.com';
  </script>

  <!-- Register Service Worker (for offline + updates) -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>

  <!-- App logic -->
  <script type="module" src="/src/main.js"></script>
</body>
</html>
